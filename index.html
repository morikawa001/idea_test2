<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç¾å ´ã®çŠ¶æ³èª¿æŸ»ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ç¾¤ï¼‰</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
  background: #f2f8f5;
  color: #333;
  padding: 20px;
  min-height: 100vh;
}
.container { max-width: 720px; margin: 0 auto; }

/* ===== ãƒ˜ãƒƒãƒ€ãƒ¼ ===== */
.header {
  background: linear-gradient(135deg, #2d7a5f, #4caf88);
  color: white;
  padding: 24px 28px;
  border-radius: 12px 12px 0 0;
  text-align: center;
}
.header h1 { font-size: 1.4em; margin-bottom: 6px; }
.header p  { font-size: 0.85em; opacity: 0.88; }

/* ===== ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ ===== */
.stepper {
  display: flex;
  background: white;
  padding: 14px 20px;
  gap: 4px;
  align-items: center;
  border-bottom: 1px solid #d4eddf;
  overflow-x: auto;
}
.step-dot {
  display: flex; flex-direction: column; align-items: center;
  gap: 4px; flex: 1; min-width: 44px;
}
.step-circle {
  width: 30px; height: 30px;
  border-radius: 50%;
  background: #d4eddf;
  color: #7fba9e;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.75em; font-weight: bold;
  transition: all 0.4s;
}
.step-circle.done   { background: #4caf88; color: white; }
.step-circle.active { background: #2d7a5f; color: white; box-shadow: 0 0 0 4px #b0ddc8; }
.step-label { font-size: 0.65em; color: #888; text-align: center; }
.step-label.active { color: #2d7a5f; font-weight: bold; }
.step-line { height: 2px; background: #d4eddf; flex: 0.3; border-radius: 1px; }
.step-line.done { background: #4caf88; }

/* ===== ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ ===== */
.progress-bar-wrap {
  background: #edf7f2;
  padding: 8px 20px;
  display: flex; align-items: center; gap: 10px;
  font-size: 0.82em; color: #2d7a5f;
}
.progress-bar-bg {
  flex: 1; height: 8px;
  background: #a8d8bb; border-radius: 4px; overflow: hidden;
}
.progress-bar-fill {
  height: 100%; width: 0%;
  background: linear-gradient(90deg, #4caf88, #82d4a8);
  border-radius: 4px; transition: width 0.5s ease;
}

/* ===== ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼ ===== */
.navigator {
  display: flex; align-items: flex-start; gap: 12px;
  background: white;
  padding: 16px 20px;
  border-bottom: 1px solid #edf7f2;
  animation: fadeSlideIn 0.4s ease;
}
.nav-avatar {
  font-size: 2.2em; flex-shrink: 0;
  animation: bounce 1s ease infinite alternate;
}
@keyframes bounce {
  from { transform: translateY(0); }
  to   { transform: translateY(-4px); }
}
.nav-bubble {
  background: #edf7f2;
  border-radius: 0 12px 12px 12px;
  padding: 10px 14px;
  font-size: 0.88em;
  line-height: 1.6;
  color: #2d7a5f;
  position: relative;
  flex: 1;
}
.nav-bubble::before {
  content: '';
  position: absolute; left: -8px; top: 10px;
  border: 8px solid transparent;
  border-right-color: #edf7f2;
  border-left: 0;
}

/* ===== ã‚¹ãƒ†ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ ===== */
.block {
  background: white;
  border-left: 5px solid #4caf88;
  border-radius: 0 0 8px 8px;
  padding: 24px 28px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  display: none;
  animation: fadeSlideIn 0.45s ease;
}
.block.active { display: block; }
@keyframes fadeSlideIn {
  from { opacity: 0; transform: translateY(18px); }
  to   { opacity: 1; transform: translateY(0); }
}

.block-title {
  font-size: 1.05em; font-weight: bold;
  color: #2d7a5f; margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid #d4eddf;
  display: flex; align-items: center; gap: 8px;
}

/* ===== è¨­å• ===== */
.q-block { margin-bottom: 24px; }
.q-label {
  font-size: 0.93em; font-weight: bold;
  margin-bottom: 6px; display: block; color: #2c3e50;
}
.q-label .req { color: #e57373; font-size: 0.82em; margin-left: 4px; }
.q-hint { font-size: 0.79em; color: #888; margin-bottom: 8px; }

/* ===== ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ ===== */
.feedback-box {
  margin-top: 8px; padding: 8px 12px;
  border-radius: 6px; font-size: 0.82em;
  line-height: 1.5; min-height: 0;
  transition: all 0.3s; display: none;
}
.feedback-box.show { display: block; }
.feedback-good    { background: #edf7f2; color: #2d7a5f; border-left: 3px solid #4caf88; }
.feedback-neutral { background: #fef9e7; color: #9a7d0a; border-left: 3px solid #f0c040; }
.feedback-tip     { background: #e8f5f0; color: #2d7a5f; border-left: 3px solid #82d4a8; }

/* ===== ãƒ•ã‚©ãƒ¼ãƒ éƒ¨å“ ===== */
select, input[type="text"], textarea {
  width: 100%; padding: 10px 13px;
  border: 1.5px solid #c5d9cc; border-radius: 7px;
  font-size: 0.92em; font-family: inherit;
  background: #fdfefe; transition: border 0.2s, box-shadow 0.2s;
}
select:focus, input:focus, textarea:focus {
  outline: none; border-color: #4caf88;
  background: #edf7f2; box-shadow: 0 0 0 3px rgba(76,175,136,0.15);
}
textarea { resize: vertical; min-height: 80px; }

/* ===== ãƒ©ã‚¸ã‚ªãƒ»ãƒã‚§ãƒƒã‚¯ ===== */
.radio-group, .check-group {
  display: flex; flex-direction: column; gap: 8px;
}
.radio-group label, .check-group label {
  display: flex; align-items: flex-start; gap: 10px;
  font-size: 0.90em; cursor: pointer;
  padding: 9px 14px;
  border: 1.5px solid #d4eddf; border-radius: 8px;
  transition: all 0.2s; background: #fdfefe;
}
.radio-group label:hover, .check-group label:hover {
  background: #edf7f2; border-color: #a8d8bb;
}
.radio-group label.selected, .check-group label.selected {
  background: #edf7f2; border-color: #4caf88;
  box-shadow: 0 0 0 2px rgba(76,175,136,0.18);
}
.radio-group input, .check-group input {
  margin-top: 2px; accent-color: #4caf88; flex-shrink: 0;
}

/* ===== ãã®ä»–ãƒ†ã‚­ã‚¹ãƒˆ ===== */
.other-input-wrap {
  display: none;
  margin-top: 8px;
  padding: 10px 14px;
  background: #f4fbf7;
  border-radius: 6px;
  border: 1.5px dashed #a8d8bb;
  animation: fadeSlideIn 0.3s ease;
}
.other-input-wrap.show { display: block; }
.other-input-wrap textarea { min-height: 60px; background: white; }

/* ===== ãƒœã‚¿ãƒ³ ===== */
.nav-btn-row {
  display: flex; gap: 12px;
  justify-content: space-between;
  margin-top: 28px; flex-wrap: wrap;
}
.btn-prev    { background: #dce5df; color: #5a6b5e; }
.btn-next    { background: #4caf88; color: white; flex: 1; }
.btn-preview { background: #2d7a5f; color: white; flex: 1; }
.btn-reset   { background: #b2c5ba; color: white; }
.btn-finish  { background: #2d7a5f; color: white; }
button {
  padding: 12px 22px; border: none; border-radius: 8px;
  font-size: 0.95em; font-weight: bold; cursor: pointer;
  font-family: inherit; transition: opacity 0.2s, transform 0.1s;
}
button:hover  { opacity: 0.88; }
button:active { transform: scale(0.97); }

/* ===== ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ ===== */
.check-anim {
  display: inline-block;
  animation: popIn 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
}
@keyframes popIn {
  0%   { transform: scale(0); opacity: 0; }
  80%  { transform: scale(1.3); }
  100% { transform: scale(1); opacity: 1; }
}

/* ===== ãƒ¢ãƒ¼ãƒ€ãƒ«å…±é€š ===== */
.modal-overlay {
  display: none; position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.50); z-index: 1000;
  align-items: center; justify-content: center;
}
.modal-overlay.active { display: flex; }
.modal {
  background: white; border-radius: 14px;
  padding: 28px; max-width: 640px; width: 94%;
  max-height: 88vh; overflow-y: auto;
  box-shadow: 0 10px 40px rgba(0,0,0,0.18);
  animation: fadeSlideIn 0.35s ease;
}
.modal h2 { color: #2d7a5f; margin-bottom: 12px; font-size: 1.1em; }
.modal pre {
  background: #f4f8f6; padding: 14px; border-radius: 8px;
  font-size: 0.81em; white-space: pre-wrap; line-height: 1.75;
  font-family: 'Courier New', monospace; border: 1px solid #d4eddf;
}
.modal-btn-row { display: flex; gap: 10px; margin-top: 16px; flex-wrap: wrap; }
.btn-mail  { background: #4caf88; color: white; }
.btn-dl    { background: #2d7a5f; color: white; }
.btn-close { background: #b2c5ba; color: white; }

/* ===== æ„Ÿè¬ãƒ¢ãƒ¼ãƒ€ãƒ« ===== */
.thank-modal-overlay {
  display: none; position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.55); z-index: 2000;
  align-items: center; justify-content: center;
}
.thank-modal-overlay.active { display: flex; }
.thank-modal {
  background: white; border-radius: 20px;
  padding: 44px 36px; max-width: 440px; width: 92%;
  text-align: center;
  box-shadow: 0 12px 48px rgba(0,0,0,0.20);
  animation: thankPop 0.5s cubic-bezier(0.175,0.885,0.32,1.275);
}
@keyframes thankPop {
  0%   { opacity: 0; transform: scale(0.7); }
  80%  { transform: scale(1.04); }
  100% { opacity: 1; transform: scale(1); }
}
.thank-icon {
  font-size: 4em; margin-bottom: 16px;
  animation: iconBounce 0.6s 0.3s cubic-bezier(0.175,0.885,0.32,1.275) both;
}
@keyframes iconBounce {
  0%   { transform: scale(0) rotate(-20deg); opacity: 0; }
  80%  { transform: scale(1.2) rotate(5deg); }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}
.thank-title {
  font-size: 1.45em; font-weight: bold;
  color: #2d7a5f; margin-bottom: 12px;
}
.thank-body {
  font-size: 0.92em; color: #555;
  line-height: 1.9; margin-bottom: 16px;
}
.thank-body strong { color: #4caf88; }
.thank-reply-box {
  background: #edf7f2;
  border-left: 4px solid #4caf88;
  border-radius: 8px;
  padding: 12px 16px;
  margin: 0 0 24px;
  font-size: 0.88em;
  color: #2d7a5f;
  text-align: left;
  line-height: 1.7;
}
.thank-reply-box .reply-email {
  font-weight: bold;
  word-break: break-all;
  color: #1a5c40;
}
.thank-btn-row { display: flex; flex-direction: column; gap: 10px; }
.btn-new-entry {
  background: linear-gradient(135deg, #2d7a5f, #4caf88);
  color: white; padding: 13px 20px;
  border: none; border-radius: 10px;
  font-size: 0.95em; font-weight: bold;
  cursor: pointer; font-family: inherit;
  transition: opacity 0.2s, transform 0.1s;
}
.btn-new-entry:hover  { opacity: 0.88; }
.btn-new-entry:active { transform: scale(0.97); }
.btn-just-close {
  background: #ecf0f1; color: #777;
  padding: 10px 20px;
  border: none; border-radius: 10px;
  font-size: 0.88em; cursor: pointer; font-family: inherit;
  transition: opacity 0.2s;
}
.btn-just-close:hover { opacity: 0.75; }

/* ===== çµ‚äº†ç”»é¢ ===== */
.end-screen {
  display: none;
  background: white;
  border-radius: 0 0 12px 12px;
  padding: 56px 36px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  animation: fadeSlideIn 0.5s ease;
}
.end-screen.active { display: block; }
.end-icon {
  font-size: 4.5em;
  margin-bottom: 20px;
  animation: iconBounce 0.6s 0.2s cubic-bezier(0.175,0.885,0.32,1.275) both;
}
.end-title {
  font-size: 1.55em; font-weight: bold;
  color: #2d7a5f; margin-bottom: 16px;
}
.end-divider {
  width: 60px; height: 3px;
  background: linear-gradient(90deg, #4caf88, #82d4a8);
  border-radius: 2px; margin: 0 auto 28px;
}
.end-body {
  font-size: 0.95em; color: #555;
  line-height: 2.1; margin-bottom: 36px;
}
.end-body strong { color: #4caf88; }
.btn-restart {
  background: #edf7f2; color: #2d7a5f;
  border: 2px solid #4caf88;
  padding: 12px 32px; border-radius: 8px;
  font-size: 0.93em; font-weight: bold;
  cursor: pointer; font-family: inherit;
  transition: all 0.2s;
}
.btn-restart:hover  { background: #d4eddf; }
.btn-restart:active { transform: scale(0.97); }

@media(max-width:600px){
  .nav-btn-row { flex-direction: column; }
  button { width: 100%; }
  .stepper { gap: 2px; padding: 10px 8px; }
  .step-label { font-size: 0.58em; }
  .end-screen { padding: 40px 20px; }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ğŸ“‹ ç¾å ´ã®çŠ¶æ³èª¿æŸ»ãƒ•ã‚©ãƒ¼ãƒ </h1>
    <p>ç¾åœ¨ã®æ¥­å‹™ãƒ»ã‚±ã‚¢ã®å®Ÿæ…‹ã‚’ãŠèã‹ã›ãã ã•ã„ã€‚3ã€œ5åˆ†ã§å…¥åŠ›ã§ãã¾ã™ã€‚</p>
  </div>

  <!-- ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ -->
  <div class="stepper" id="stepper">
    <div class="step-dot">
      <div class="step-circle active" id="sc0">1</div>
      <div class="step-label active" id="sl0">åŸºæœ¬æƒ…å ±</div>
    </div>
    <div class="step-line" id="line0"></div>
    <div class="step-dot">
      <div class="step-circle" id="sc1">2</div>
      <div class="step-label" id="sl1">ç¾å ´ã®çŠ¶æ³</div>
    </div>
    <div class="step-line" id="line1"></div>
    <div class="step-dot">
      <div class="step-circle" id="sc2">3</div>
      <div class="step-label" id="sl2">ç¾åœ¨ã®å¯¾å¿œ</div>
    </div>
    <div class="step-line" id="line2"></div>
    <div class="step-dot">
      <div class="step-circle" id="sc3">4</div>
      <div class="step-label" id="sl3">æ¥­å‹™ã®å®Ÿæ…‹</div>
    </div>
    <div class="step-line" id="line3"></div>
    <div class="step-dot">
      <div class="step-circle" id="sc4">5</div>
      <div class="step-label" id="sl4">ç¾çŠ¶ã®è©•ä¾¡</div>
    </div>
  </div>

  <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
  <div class="progress-bar-wrap" id="progressWrap">
    <span id="progress-label">0 / 14 é …ç›®å…¥åŠ›æ¸ˆã¿</span>
    <div class="progress-bar-bg">
      <div class="progress-bar-fill" id="progressFill"></div>
    </div>
  </div>

  <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼ -->
  <div class="navigator" id="navigator">
    <div class="nav-avatar">ğŸ¤–</div>
    <div class="nav-bubble" id="navBubble">
      ã“ã‚“ã«ã¡ã¯ï¼ç¾åœ¨ã®ç¾å ´ã®çŠ¶æ³ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„ã€‚<br>
      ã¾ãšã€<strong>ã‚ãªãŸã®åŸºæœ¬æƒ…å ±</strong>ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚æ°—è»½ã«å…¥åŠ›ã—ã¦ãã ã•ã„ğŸ˜Š
    </div>
  </div>

  <form id="ideaForm" novalidate>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—1ï¼šåŸºæœ¬æƒ…å ± -->
    <div class="block active" id="step0">
      <div class="block-title">ğŸ“‹ ç¬¬1ã‚¹ãƒ†ãƒƒãƒ—ï¼šåŸºæœ¬æƒ…å ±</div>

      <div class="q-block">
        <label class="q-label">Q1. æ‰€å±éƒ¨ç½² <span class="req">â˜…å¿…é ˆ</span></label>
        <select id="q1" required onchange="onSelectChange('q1')">
          <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
          <option>GICU</option><option>æ‰‹è¡“å®¤</option><option>å¤–æ¥</option>
          <option>ç—…æ£Ÿ</option><option>ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç§‘</option><option>è–¬å‰¤éƒ¨</option>
          <option>æ”¾å°„ç·šç§‘</option><option>è‡¨åºŠæ¤œæŸ»éƒ¨</option>
          <option>åŒ»ç™‚æƒ…å ±ãƒ»ã‚·ã‚¹ãƒ†ãƒ éƒ¨é–€</option><option>è‡¨åºŠç ”ç©¶æ”¯æ´ã‚»ãƒ³ã‚¿ãƒ¼</option>
          <option>äº‹å‹™éƒ¨é–€</option><option>ãã®ä»–</option>
        </select>
        <div class="feedback-box feedback-good" id="fb-q1"></div>
      </div>

      <div class="q-block">
        <label class="q-label">Q2. æ°å <span class="req">â˜…å¿…é ˆ</span></label>
        <div class="q-hint">ğŸ‘¤ ãƒ•ãƒ«ãƒãƒ¼ãƒ ã§ã”è¨˜å…¥ãã ã•ã„ï¼ˆåŒ¿åã§ã®å—ä»˜ã¯ã§ãã¾ã›ã‚“ï¼‰</div>
        <input type="text" id="q2"
               placeholder="ä¾‹ï¼šå±±ç”° å¤ªéƒ"
               oninput="onTextInput('q2')" required>
        <div class="feedback-box" id="fb-q2"></div>
      </div>

      <div class="q-block">
        <label class="q-label">Q2-b. è¿”ä¿¡ç”¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span class="req">â˜…å¿…é ˆ</span></label>
        <div class="q-hint">ğŸ“§ èª¿æŸ»çµæœã®ã”é€£çµ¡å…ˆã¨ã—ã¦ã”ä½¿ç”¨ã—ã¾ã™</div>
        <input type="text" id="q2b"
               placeholder="ä¾‹ï¼šyamada.taro@example.com"
               oninput="onEmailInput('q2b')" required>
        <div class="feedback-box" id="fb-q2b"></div>
      </div>

      <div class="q-block">
        <label class="q-label">Q3. è·ç¨® <span class="req">â˜…å¿…é ˆ</span></label>
        <div class="radio-group" id="q3">
          <label><input type="radio" name="q3" value="åŒ»å¸«" onchange="onRadioChange('q3')"> åŒ»å¸«</label>
          <label><input type="radio" name="q3" value="çœ‹è­·å¸«" onchange="onRadioChange('q3')"> çœ‹è­·å¸«</label>
          <label><input type="radio" name="q3" value="è–¬å‰¤å¸«" onchange="onRadioChange('q3')"> è–¬å‰¤å¸«</label>
          <label><input type="radio" name="q3" value="è‡¨åºŠå·¥å­¦æŠ€å£«" onchange="onRadioChange('q3')"> è‡¨åºŠå·¥å­¦æŠ€å£«</label>
          <label><input type="radio" name="q3" value="ç†å­¦ç™‚æ³•å£«ãƒ»ä½œæ¥­ç™‚æ³•å£«" onchange="onRadioChange('q3')"> ç†å­¦ç™‚æ³•å£«ãƒ»ä½œæ¥­ç™‚æ³•å£«</label>
          <label><input type="radio" name="q3" value="äº‹å‹™è·" onchange="onRadioChange('q3')"> äº‹å‹™è·</label>
          <label><input type="radio" name="q3" value="ãã®ä»–" onchange="onRadioChange('q3')"> ãã®ä»–</label>
        </div>
        <div class="feedback-box" id="fb-q3"></div>
      </div>

      <div class="nav-btn-row">
        <button type="button" class="btn-next" onclick="goNext(0)">æ¬¡ã¸ï¼šç¾å ´ã®çŠ¶æ³ â†’</button>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—2ï¼šç¾å ´ã®çŠ¶æ³ -->
    <div class="block" id="step1">
      <div class="block-title">ğŸ” ç¬¬2ã‚¹ãƒ†ãƒƒãƒ—ï¼šç¾å ´ã®çŠ¶æ³</div>

      <div class="q-block">
        <label class="q-label">Q4. ä¸»ã«å½±éŸ¿ã‚’å—ã‘ã¦ã„ã‚‹ã®ã¯èª°ã§ã™ã‹ï¼Ÿ <span class="req">â˜…å¿…é ˆ</span></label>
        <div class="radio-group" id="q4">
          <label><input type="radio" name="q4" value="æ‚£è€…ã•ã‚“" onchange="onRadioChange('q4')"> æ‚£è€…ã•ã‚“</label>
          <label><input type="radio" name="q4" value="è‡ªåˆ†è‡ªèº«ãƒ»è‡ªéƒ¨ç½²ã®ã‚¹ã‚¿ãƒƒãƒ•" onchange="onRadioChange('q4')"> è‡ªåˆ†è‡ªèº«ãƒ»è‡ªéƒ¨ç½²ã®ã‚¹ã‚¿ãƒƒãƒ•</label>
          <label><input type="radio" name="q4" value="ä»–éƒ¨ç½²ã®ã‚¹ã‚¿ãƒƒãƒ•" onchange="onRadioChange('q4')"> ä»–éƒ¨ç½²ã®ã‚¹ã‚¿ãƒƒãƒ•</label>
          <label><input type="radio" name="q4" value="ç—…é™¢å…¨ä½“" onchange="onRadioChange('q4')"> ç—…é™¢å…¨ä½“</label>
        </div>
        <div class="feedback-box" id="fb-q4"></div>
      </div>

      <div class="q-block">
        <label class="q-label">Q5. è©²å½“ã™ã‚‹å ´é¢ã®ç™ºç”Ÿé »åº¦ã¯ï¼Ÿ <span class="req">â˜…å¿…é ˆ</span></label>
        <div class="radio-group" id="q5">
          <label><input type="radio" name="q5" value="æ¯æ—¥è¤‡æ•°å›" onchange="onRadioChange('q5')"> æ¯æ—¥è¤‡æ•°å›</label>
          <label><input type="radio" name="q5" value="æ¯æ—¥1å›ç¨‹åº¦" onchange="onRadioChange('q5')"> æ¯æ—¥1å›ç¨‹åº¦</label>
          <label><input type="radio" name="q5" value="é€±ã«æ•°å›" onchange="onRadioChange('q5')"> é€±ã«æ•°å›</label>
          <label><input type="radio" name="q5" value="æœˆã«æ•°å›" onchange="onRadioChange('q5')"> æœˆã«æ•°å›</label>
          <label><input type="radio" name="q5" value="ç¨€ã ãŒç™ºç”Ÿã™ã‚‹ã¨é‡å¤§" onchange="onRadioChange('q5')"> ç¨€ã ãŒç™ºç”Ÿã™ã‚‹ã¨é‡å¤§ï¼ˆãƒã‚¤ãƒªã‚¹ã‚¯ï¼‰</label>
        </div>
        <div class="feedback-box" id="fb-q5"></div>
      </div>

      <div class="q-block">
        <label class="q-label">Q6. ç¾åœ¨ç”Ÿã˜ã¦ã„ã‚‹å½±éŸ¿ãƒ»è² æ‹…ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ <span class="req">â˜…å¿…é ˆ</span>ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
        <div class="check-group" id="q6">
          <label><input type="checkbox" name="q6" value="åŒ»ç™‚å®‰å…¨ä¸Šã®æ‡¸å¿µï¼ˆã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒªã‚¹ã‚¯ãªã©ï¼‰" onchange="onCheckChange('q6')"> åŒ»ç™‚å®‰å…¨ä¸Šã®æ‡¸å¿µï¼ˆã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒªã‚¹ã‚¯ãªã©ï¼‰</label>
          <label><input type="checkbox" name="q6" value="æ¥­å‹™æ™‚é–“ã®åœ§è¿«ï¼ˆæ®‹æ¥­ãƒ»ç„¡é§„ãªè»¢è¨˜ä½œæ¥­ãªã©ï¼‰" onchange="onCheckChange('q6')"> æ¥­å‹™æ™‚é–“ã®åœ§è¿«ï¼ˆæ®‹æ¥­ãƒ»ç„¡é§„ãªè»¢è¨˜ä½œæ¥­ãªã©ï¼‰</label>
          <label><input type="checkbox" name="q6" value="æ‚£è€…ã•ã‚“ã®è‹¦ç—›ãƒ»QOLä½ä¸‹ï¼ˆç—›ã¿ã€é›¢åºŠã®é…ã‚Œãªã©ï¼‰" onchange="onCheckChange('q6')"> æ‚£è€…ã•ã‚“ã®è‹¦ç—›ãƒ»QOLä½ä¸‹ï¼ˆç—›ã¿ã€é›¢åºŠã®é…ã‚Œãªã©ï¼‰</label>
          <label><input type="checkbox" name="q6" value="ã‚¹ã‚¿ãƒƒãƒ•ã®èº«ä½“çš„ãƒ»ç²¾ç¥çš„è² æ‹…" onchange="onCheckChange('q6')"> ã‚¹ã‚¿ãƒƒãƒ•ã®èº«ä½“çš„ãƒ»ç²¾ç¥çš„è² æ‹…</label>
          <label><input type="checkbox" name="q6" value="ç‰©å“ã‚„ã‚³ã‚¹ãƒˆã®ç„¡é§„" onchange="onCheckChange('q6')"> ç‰©å“ã‚„ã‚³ã‚¹ãƒˆã®ç„¡é§„</label>
          <label><input type="checkbox" name="q6" value="ãã®ä»–" id="q6-other-check"
                        onchange="onCheckChange('q6'); toggleOtherInput('q6-other-check','q6-other-wrap')"> ãã®ä»–</label>
        </div>
        <div class="other-input-wrap" id="q6-other-wrap">
          <div class="q-hint" style="margin-bottom:6px;">ğŸ“ å…·ä½“çš„ã«ã©ã®ã‚ˆã†ãªå½±éŸ¿ãƒ»è² æ‹…ã‹æ•™ãˆã¦ãã ã•ã„</div>
          <textarea id="q6-other-text" placeholder="ä¾‹ï¼šè¨˜éŒ²ã®è»¢è¨˜ãƒŸã‚¹ãŒèµ·ãã‚„ã™ã„ã€æƒ…å ±å…±æœ‰ã«æ™‚é–“ãŒã‹ã‹ã‚‹ ãªã©" oninput="updateProgress()"></textarea>
        </div>
        <div class="feedback-box" id="fb-q6"></div>
      </div>

      <div class="q-block">
        <label class="q-label">Q7. è©²å½“ã™ã‚‹å…·ä½“çš„ãªå ´é¢ã‚’æ•™ãˆã¦ãã ã•ã„</label>
        <div class="q-hint">ğŸ’¬ ã„ã¤ãƒ»ã©ã“ã§ãƒ»èª°ãŒãƒ»ä½•ãŒèµ·ãã‚‹ã‹ã‚’æ›¸ãã¨ä¼ã‚ã‚Šã‚„ã™ã„ã§ã™</div>
        <textarea id="q7" placeholder="ä¾‹ï¼šè¡“å¾Œã€æ‚£è€…ã•ã‚“ãŒè¤‡æ•°ãƒ«ãƒ¼ãƒˆã‚’æŒã£ãŸã¾ã¾æ­©è¡Œã™ã‚‹éš›ã€ãƒãƒ¥ãƒ¼ãƒ–ãŒå¼•ã£ã‹ã‹ã‚Šã‚„ã™ã„"
                  oninput="onTextareaInput('q7')"></textarea>
        <div class="feedback-box" id="fb-q7"></div>
      </div>

      <div class="nav-btn-row">
        <button type="button" class="btn-prev" onclick="goPrev(1)">â† æˆ»ã‚‹</button>
        <button type="button" class="btn-next" onclick="goNext(1)">æ¬¡ã¸ï¼šç¾åœ¨ã®å¯¾å¿œ â†’</button>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—3ï¼šç¾åœ¨ã®å¯¾å¿œ -->
    <div class="block" id="step2">
      <div class="block-title">ğŸ”„ ç¬¬3ã‚¹ãƒ†ãƒƒãƒ—ï¼šç¾åœ¨ã®å¯¾å¿œã¨ãã®çŠ¶æ³</div>

      <div class="q-block">
        <label class="q-label">Q8. ç¾åœ¨ã€ç¾å ´ã§ã¯ã©ã®ã‚ˆã†ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã‹ï¼Ÿ</label>
        <textarea id="q8" placeholder="ä¾‹ï¼šãƒãƒ¥ãƒ¼ãƒ–ã‚’ã¾ã¨ã‚ã¦ãƒ†ãƒ¼ãƒ—ã§ç•™ã‚ã¦ã„ã‚‹ã€ã‚¹ã‚¿ãƒƒãƒ•ãŒå¸¸ã«ä»˜ãæ·»ã† ãªã©"
                  oninput="onTextareaInput('q8')"></textarea>
        <div class="feedback-box" id="fb-q8"></div>
      </div>

      <div class="q-block">
        <label class="q-label">Q9. ä»Šã®å¯¾å¿œã«ä¼´ã†èª²é¡Œã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
        <div class="check-group" id="q9">
          <label><input type="checkbox" name="q9" value="æ‰‹ä½œæ¥­ãŒå¤šãã¦æ™‚é–“ãŒã‹ã‹ã‚‹" onchange="onCheckChange('q9')"> æ‰‹ä½œæ¥­ãŒå¤šãã¦æ™‚é–“ãŒã‹ã‹ã‚‹</label>
          <label><input type="checkbox" name="q9" value="äººã«ã‚ˆã£ã¦ã‚„ã‚Šæ–¹ã‚„ç²¾åº¦ã«ã°ã‚‰ã¤ããŒå‡ºã‚‹" onchange="onCheckChange('q9')"> äººã«ã‚ˆã£ã¦ã‚„ã‚Šæ–¹ã‚„ç²¾åº¦ã«ã°ã‚‰ã¤ããŒå‡ºã‚‹</label>
          <label><input type="checkbox" name="q9" value="æ ¹æœ¬çš„ãªå®‰å…¨ç¢ºä¿ã«ãªã£ã¦ã„ãªã„" onchange="onCheckChange('q9')"> æ ¹æœ¬çš„ãªå®‰å…¨ç¢ºä¿ã«ãªã£ã¦ã„ãªã„</label>
          <label><input type="checkbox" name="q9" value="æ¶ˆè€—å“è²»ãªã©ã®ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹" onchange="onCheckChange('q9')"> æ¶ˆè€—å“è²»ãªã©ã®ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹</label>
          <label><input type="checkbox" name="q9" value="ã‚¹ã‚¿ãƒƒãƒ•ã¸ã®æ•™è‚²ã‚³ã‚¹ãƒˆãŒé«˜ã„" onchange="onCheckChange('q9')"> ã‚¹ã‚¿ãƒƒãƒ•ã¸ã®æ•™è‚²ã‚³ã‚¹ãƒˆãŒé«˜ã„</label>
        </div>
        <div class="feedback-box" id="fb-q9"></div>
      </div>

      <div class="nav-btn-row">
        <button type="button" class="btn-prev" onclick="goPrev(2)">â† æˆ»ã‚‹</button>
        <button type="button" class="btn-next" onclick="goNext(2)">æ¬¡ã¸ï¼šæ¥­å‹™ã®å®Ÿæ…‹ â†’</button>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—4ï¼šæ¥­å‹™ã®å®Ÿæ…‹ -->
    <div class="block" id="step3">
      <div class="block-title">ğŸ“„ ç¬¬4ã‚¹ãƒ†ãƒƒãƒ—ï¼šç¾åœ¨ã®æ¥­å‹™ãƒ»ã‚±ã‚¢ã®å®Ÿæ…‹</div>

      <div class="q-block">
        <label class="q-label">Q10. ç¾åœ¨ã®æ¥­å‹™ãƒ»ã‚±ã‚¢ã®ã‚„ã‚Šæ–¹ã‚’å…·ä½“çš„ã«æ•™ãˆã¦ãã ã•ã„ <span class="req">â˜…å¿…é ˆ</span></label>
        <div class="q-hint">ğŸ’¬ å®Ÿéš›ã«è¡Œã£ã¦ã„ã‚‹æ‰‹é †ãƒ»æ–¹æ³•ã‚’ã§ãã‚‹ã ã‘å…·ä½“çš„ã«è¨˜å…¥ã—ã¦ãã ã•ã„</div>
        <textarea id="q10" rows="5" placeholder="ç¾åœ¨ã®æ‰‹é †ã‚„æ–¹æ³•ã‚’ãã®ã¾ã¾è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚"
                  oninput="onCurrentPracticeInput()" required></textarea>
        <div class="feedback-box" id="fb-q10"></div>
      </div>

      <div class="q-block">
        <label class="q-label">Q11. ç¾åœ¨ã®å¯¾å¿œæ–¹æ³•ã®åˆ†é¡ï¼ˆä¸€ç•ªè¿‘ã„ã‚‚ã®ï¼‰ <span class="req">â˜…å¿…é ˆ</span></label>
        <div class="q-hint">âš¡ ä¸€ç•ªè¿‘ã„ã‚‚ã®ã‚’é¸ã‚“ã§ãã ã•ã„</div>
        <div class="radio-group" id="q11">
          <label><input type="radio" name="q11" value="æ—¢å­˜ã®åŒ»ç™‚æ©Ÿå™¨ãƒ»å™¨å…·ã‚’ä½¿ç”¨" onchange="onRadioChange('q11')"> ğŸ”§ æ—¢å­˜ã®åŒ»ç™‚æ©Ÿå™¨ãƒ»å™¨å…·ã‚’ä½¿ç”¨</label>
          <label><input type="radio" name="q11" value="æ—¢å­˜ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ»é›»å­ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨" onchange="onRadioChange('q11')"> ğŸ’» æ—¢å­˜ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ»é›»å­ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨</label>
          <label><input type="radio" name="q11" value="æ—¢å­˜è£½å“ã‚’ãã®ã¾ã¾ä½¿ç”¨ï¼ˆæ¨™æº–çš„ãªä½¿ã„æ–¹ï¼‰" onchange="onRadioChange('q11')"> ğŸ“¦ æ—¢å­˜è£½å“ã‚’ãã®ã¾ã¾ä½¿ç”¨ï¼ˆæ¨™æº–çš„ãªä½¿ã„æ–¹ï¼‰</label>
          <label><input type="radio" name="q11" value="ç¾è¡Œã®é‹ç”¨ãƒ«ãƒ¼ãƒ«ãƒ»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã«å¾“ã£ã¦å¯¾å¿œ" onchange="onRadioChange('q11')"> ğŸ“„ ç¾è¡Œã®é‹ç”¨ãƒ«ãƒ¼ãƒ«ãƒ»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã«å¾“ã£ã¦å¯¾å¿œ</label>
        </div>
        <div class="feedback-box" id="fb-q11"></div>
      </div>

      <div class="nav-btn-row">
        <button type="button" class="btn-prev" onclick="goPrev(3)">â† æˆ»ã‚‹</button>
        <button type="button" class="btn-next" onclick="goNext(3)">æ¬¡ã¸ï¼šç¾çŠ¶ã®è©•ä¾¡ â†’</button>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—5ï¼šç¾çŠ¶ã®è©•ä¾¡ -->
    <div class="block" id="step4">
      <div class="block-title">ğŸ“Š ç¬¬5ã‚¹ãƒ†ãƒƒãƒ—ï¼šç¾çŠ¶ã®è©•ä¾¡ãƒ»æ¸¬å®š</div>

      <div class="q-block">
        <label class="q-label">Q12. ç¾åœ¨ã®çŠ¶æ³ã«ãŠã„ã¦è¦³å¯Ÿãƒ»æ¸¬å®šã•ã‚Œã¦ã„ã‚‹é …ç›®ã‚’é¸ã‚“ã§ãã ã•ã„ <span class="req">â˜…å¿…é ˆ</span>ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
        <div class="check-group" id="q12">
          <label><input type="checkbox" name="q12" value="ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç™ºç”Ÿä»¶æ•°ãƒ»é »åº¦" onchange="onCheckChange('q12')"> ğŸ›¡ï¸ ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç™ºç”Ÿä»¶æ•°ãƒ»é »åº¦</label>
          <label><input type="checkbox" name="q12" value="æ¥­å‹™æ™‚é–“ãƒ»è¨˜éŒ²æ™‚é–“" onchange="onCheckChange('q12')"> â±ï¸ æ¥­å‹™æ™‚é–“ãƒ»è¨˜éŒ²æ™‚é–“</label>
          <label><input type="checkbox" name="q12" value="æ‚£è€…ã•ã‚“ã®å›å¾©çŠ¶æ³ï¼ˆé›¢åºŠãƒ»QOLãªã©ï¼‰" onchange="onCheckChange('q12')"> ğŸƒ æ‚£è€…ã•ã‚“ã®å›å¾©çŠ¶æ³ï¼ˆé›¢åºŠãƒ»QOLãªã©ï¼‰</label>
          <label><input type="checkbox" name="q12" value="ç‰©å“ãƒ»ã‚³ã‚¹ãƒˆã®ä½¿ç”¨çŠ¶æ³" onchange="onCheckChange('q12')"> ğŸ’´ ç‰©å“ãƒ»ã‚³ã‚¹ãƒˆã®ä½¿ç”¨çŠ¶æ³</label>
          <label><input type="checkbox" name="q12" value="ã‚¹ã‚¿ãƒƒãƒ•ã®è² æ‹…æ„Ÿãƒ»æº€è¶³åº¦" onchange="onCheckChange('q12')"> ğŸ˜Š ã‚¹ã‚¿ãƒƒãƒ•ã®è² æ‹…æ„Ÿãƒ»æº€è¶³åº¦</label>
          <label><input type="checkbox" name="q12" value="ãã®ä»–" id="q12-other-check"
                        onchange="onCheckChange('q12'); toggleOtherInput('q12-other-check','q12-other-wrap')"> ãã®ä»–</label>
        </div>
        <div class="other-input-wrap" id="q12-other-wrap">
          <div class="q-hint" style="margin-bottom:6px;">ğŸ“ è¦³å¯Ÿãƒ»æ¸¬å®šã—ã¦ã„ã‚‹é …ç›®ã‚’å…·ä½“çš„ã«æ•™ãˆã¦ãã ã•ã„</div>
          <textarea id="q12-other-text" placeholder="ä¾‹ï¼šæ‚£è€…æº€è¶³åº¦ã€ã‚¹ã‚¿ãƒƒãƒ•é–“ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ³ ãªã©" oninput="updateProgress()"></textarea>
        </div>
        <div class="feedback-box" id="fb-q12"></div>
      </div>

      <div class="q-block">
        <label class="q-label">Q13. ç¾çŠ¶ã®æ•°å€¤ãƒ»é »åº¦ãªã©å®šé‡çš„ãªæƒ…å ±ãŒã‚ã‚Œã°è¨˜å…¥ã—ã¦ãã ã•ã„</label>
        <div class="q-hint">ğŸ’¬ è¨˜å…¥ä¾‹ï¼š1æ—¥ã‚ãŸã‚Šã®å¹³å‡æ¥­å‹™æ™‚é–“ / æœˆé–“ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆä»¶æ•° / è¡“å¾Œå¹³å‡é›¢åºŠæ—¥æ•° ãªã©</div>
        <textarea id="q13" placeholder="ç¾åœ¨ã®å®Ÿæ¸¬å€¤ã‚„è¦³å¯Ÿå€¤ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚ã‚ã‹ã‚‹ç¯„å›²ã§æ§‹ã„ã¾ã›ã‚“ã€‚"
                  oninput="onTextareaInput('q13')"></textarea>
        <div class="feedback-box" id="fb-q13"></div>
      </div>

      <div class="q-block">
        <label class="q-label">Q14. å‚è€ƒã«ãªã‚‹è³‡æ–™ãƒ»è¨˜éŒ²ãŒã‚ã‚Œã°ãƒ¡ãƒ¼ãƒ«ã«æ·»ä»˜ã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰</label>
        <div class="q-hint">ğŸ“ ç¾åœ¨ã®æ¥­å‹™æ‰‹é †æ›¸ã€è¨˜éŒ²æ§˜å¼ã€å‚è€ƒå†™çœŸãªã©ï¼ˆJPGãƒ»PNGãƒ»PDFå¯¾å¿œï¼‰ã‚’ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ™‚ã«ç›´æ¥æ·»ä»˜ã—ã¦ãã ã•ã„ã€‚</div>
      </div>

      <div class="nav-btn-row">
        <button type="button" class="btn-prev" onclick="goPrev(4)">â† æˆ»ã‚‹</button>
        <button type="button" class="btn-preview" onclick="showPreview()">ğŸ‘ï¸ å†…å®¹ã‚’ç¢ºèªã—ã¦é€ä¿¡</button>
      </div>
      <div style="display:flex; gap:12px; justify-content:center; margin-top:12px; flex-wrap:wrap;">
        <button type="button" class="btn-reset"  onclick="resetForm()">ğŸ”„ æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
        <button type="button" class="btn-finish" onclick="showEndScreen()">âœ… çµ‚äº†</button>
      </div>
    </div>

  </form>

  <!-- çµ‚äº†ç”»é¢ -->
  <div class="end-screen" id="endScreen">
    <div class="end-icon">ğŸŒ¿</div>
    <div class="end-title">ã”å”åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ</div>
    <div class="end-divider"></div>
    <div class="end-body">
      ã„ãŸã ã„ãŸç¾å ´ã®æƒ…å ±ã¯ã€<strong>ç ”ç©¶ã®é‡è¦ãªãƒ‡ãƒ¼ã‚¿</strong>ã¨ã—ã¦æ´»ç”¨ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚<br>
      æ‹…å½“è€…ã«ã¦å†…å®¹ã‚’ç¢ºèªã—ã€<strong>çµæœã‚’ãƒ¡ãƒ¼ãƒ«ã«ã¦ã”é€£çµ¡</strong>ã„ãŸã—ã¾ã™ã€‚<br><br>
      å¼•ãç¶šãã€ç¾å ´ã®çŠ¶æ³ã«ã¤ã„ã¦ã”å”åŠ›ã‚’ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚<br>
      çš†ã•ã¾ã®ã”å”åŠ›ã«ã€å¿ƒã‚ˆã‚Šæ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™ã€‚ğŸ’š
    </div>
    <button type="button" class="btn-restart" onclick="restartFromEnd()">
      ğŸ”„ æ–°ã—ã„å›ç­”ã‚’å…¥åŠ›ã™ã‚‹
    </button>
  </div>

</div><!-- /container -->

<!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼†é€ä¿¡ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-overlay" id="previewModal">
  <div class="modal">
    <h2>ğŸ“‹ å…¥åŠ›å†…å®¹ã®ç¢ºèª</h2>
    <p style="font-size:0.85em;color:#666;margin-bottom:12px;">ä»¥ä¸‹ã®å†…å®¹ã§æå‡ºã—ã¾ã™ã€‚é€ä¿¡æ–¹æ³•ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
    <pre id="previewText"></pre>
    <div class="modal-btn-row">
      <button class="btn-mail"  onclick="sendMail()">âœ‰ï¸ ãƒ¡ãƒ¼ãƒ«ã§é€ä¿¡</button>
      <button class="btn-dl"    onclick="downloadTxt()">ğŸ’¾ TXTã§ä¿å­˜</button>
      <button class="btn-close" onclick="closePreviewAndThank()">âœ– é–‰ã˜ã‚‹</button>
    </div>
  </div>
</div>

<!-- æ„Ÿè¬ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="thank-modal-overlay" id="thankModal">
  <div class="thank-modal">
    <div class="thank-icon">âœ…</div>
    <div class="thank-title">ã”å›ç­”ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</div>
    <div class="thank-body">
      <strong id="thank-name-label"></strong><br>
      ã„ãŸã ã„ãŸç¾å ´ã®æƒ…å ±ãŒã€<br>
      <strong>ç ”ç©¶ã®é‡è¦ãªãƒ‡ãƒ¼ã‚¿</strong>ã¨ãªã‚Šã¾ã™ã€‚<br><br>
      å†…å®¹ã‚’ç¢ºèªå¾Œã€<br>
      <strong>ç™»éŒ²ã„ãŸã ã„ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¸ã”é€£çµ¡</strong>ã„ãŸã—ã¾ã™ã€‚<br>
      ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ğŸ˜Š
    </div>
    <div class="thank-reply-box">
      ğŸ“§ é€£çµ¡å…ˆï¼š<span class="reply-email" id="thank-reply-email"></span>
    </div>
    <div class="thank-btn-row">
      <button class="btn-new-entry" onclick="startNewEntry()">ğŸ“‹ æ–°ã—ã„å›ç­”ã‚’å…¥åŠ›ã™ã‚‹</button>
      <button class="btn-just-close" onclick="closeThankModal()">ã“ã®ã¾ã¾é–‰ã˜ã‚‹</button>
    </div>
  </div>
</div>

<script>
const MAIL_TO = 'ns.morizo@gmail.com';
const NAME_NG_WORDS = ['åŒ¿å', 'ç„¡è¨˜å', 'anonymous', 'anon', 'åç„¡ã—', 'ãªã—', 'ãªã„', 'none', 'no name'];
const FORM_UI_IDS = ['stepper', 'progressWrap', 'navigator', 'ideaForm'];

function hideFormUI() {
  FORM_UI_IDS.forEach(id => { document.getElementById(id).style.display = 'none'; });
}
function showFormUI() {
  FORM_UI_IDS.forEach(id => { document.getElementById(id).style.display = ''; });
}

let currentStep = 0;
const TOTAL_STEPS = 5;

const NAV_MESSAGES = [
  'ã“ã‚“ã«ã¡ã¯ï¼ç¾åœ¨ã®ç¾å ´ã®çŠ¶æ³ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„ã€‚<br>ã¾ãšã€<strong>ã‚ãªãŸã®åŸºæœ¬æƒ…å ±</strong>ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚æ°—è»½ã«å…¥åŠ›ã—ã¦ãã ã•ã„ğŸ˜Š',
  'åŸºæœ¬æƒ…å ±ã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼âœ¨<br>æ¬¡ã¯<strong>ç¾å ´ã®çŠ¶æ³</strong>ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚ã€Œèª°ãŒã€ã€Œã©ã‚“ãªé »åº¦ã§ã€å½±éŸ¿ã‚’å—ã‘ã¦ã„ã‚‹ã‹ã‚’ãŠèã‹ã›ãã ã•ã„ã€‚',
  'çŠ¶æ³ãŒã‚ˆãä¼ã‚ã£ã¦ãã¾ã™ï¼ğŸ‘<br>æ¬¡ã¯<strong>ç¾åœ¨ã©ã®ã‚ˆã†ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹</strong>ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚æ—¥é ƒã®å¯¾å¿œæ–¹æ³•ã‚’ç‡ç›´ã«æ•™ãˆã¦ãã ã•ã„ã€‚',
  'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚<br>æ¬¡ã¯<strong>ç¾åœ¨ã®æ¥­å‹™ãƒ»ã‚±ã‚¢ã®å®Ÿæ…‹</strong>ã‚’å…·ä½“çš„ã«æ•™ãˆã¦ãã ã•ã„ã€‚ç¾åœ¨ã®æ‰‹é †ã‚„æ–¹æ³•ã‚’ãã®ã¾ã¾ãŠæ›¸ããã ã•ã„ã€‚',
  'ã‚‚ã†ã™ãå®Œäº†ã§ã™ï¼<br>æœ€å¾Œã«<strong>ç¾åœ¨ã®çŠ¶æ³ã®è©•ä¾¡ãƒ»æ¸¬å®š</strong>ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„ã€‚æ•°å€¤ã‚„è¦³å¯Ÿå€¤ãŒã‚ã‚Œã°è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚'
];

function showStep(step) {
  document.querySelectorAll('.block').forEach((b, i) => {
    b.classList.toggle('active', i === step);
  });
  for (let i = 0; i < TOTAL_STEPS; i++) {
    const sc = document.getElementById(`sc${i}`);
    const sl = document.getElementById(`sl${i}`);
    sc.className = 'step-circle';
    sl.className = 'step-label';
    if (i < step)        { sc.classList.add('done'); sc.innerHTML = '<span class="check-anim">âœ“</span>'; }
    else if (i === step) { sc.classList.add('active'); sc.textContent = i + 1; sl.classList.add('active'); }
    else                 { sc.textContent = i + 1; }
    if (i < TOTAL_STEPS - 1) {
      document.getElementById(`line${i}`).className = 'step-line' + (i < step ? ' done' : '');
    }
  }
  document.getElementById('navBubble').innerHTML = NAV_MESSAGES[step];
  window.scrollTo({ top: 0, behavior: 'smooth' });
  currentStep = step;
}

function isNGName(val) {
  return NAME_NG_WORDS.some(w => val.toLowerCase() === w.toLowerCase());
}

const STEP_REQUIRED = [
  () => {
    const errs = [];
    if (!getVal('q1')) errs.push('Q1 æ‰€å±éƒ¨ç½²');
    const nameVal = getVal('q2');
    if (!nameVal) { errs.push('Q2 æ°å'); }
    else if (isNGName(nameVal)) { errs.push('Q2 æ°åï¼ˆåŒ¿åã§ã®å—ä»˜ã¯ã§ãã¾ã›ã‚“ã€‚ãŠåå‰ã‚’ã”è¨˜å…¥ãã ã•ã„ï¼‰'); }
    const emailVal = getVal('q2b');
    if (!emailVal) { errs.push('Q2-b è¿”ä¿¡ç”¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹'); }
    else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailVal)) { errs.push('Q2-b ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“'); }
    if (!getRadio('q3')) errs.push('Q3 è·ç¨®');
    return errs;
  },
  () => {
    const errs = [];
    if (!getRadio('q4'))              errs.push('Q4 å½±éŸ¿ã‚’å—ã‘ã¦ã„ã‚‹å¯¾è±¡');
    if (!getRadio('q5'))              errs.push('Q5 ç™ºç”Ÿé »åº¦');
    if (getChecks('q6').length === 0) errs.push('Q6 å½±éŸ¿ãƒ»è² æ‹…ã®ç¨®é¡');
    return errs;
  },
  () => [],
  () => {
    const errs = [];
    if (!getVal('q10'))   errs.push('Q10 ç¾åœ¨ã®æ¥­å‹™ãƒ»ã‚±ã‚¢ã®ã‚„ã‚Šæ–¹');
    if (!getRadio('q11')) errs.push('Q11 å¯¾å¿œæ–¹æ³•ã®åˆ†é¡');
    return errs;
  },
  () => {
    const errs = [];
    if (getChecks('q12').length === 0) errs.push('Q12 è¦³å¯Ÿãƒ»æ¸¬å®šé …ç›®');
    return errs;
  }
];

function goNext(step) {
  const errs = STEP_REQUIRED[step]();
  if (errs.length > 0) { alert('âš ï¸ ä»¥ä¸‹ã®å¿…é ˆé …ç›®ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š\n\n' + errs.join('\n')); return; }
  showStep(step + 1);
}
function goPrev(step) { showStep(step - 1); }

function getVal(id)    { return (document.getElementById(id)||{value:''}).value.trim(); }
function getRadio(nm)  { const el = document.querySelector(`input[name="${nm}"]:checked`); return el ? el.value : ''; }
function getChecks(nm) { return [...document.querySelectorAll(`input[name="${nm}"]:checked`)].map(e=>e.value); }

function getQ6Values() {
  return getChecks('q6').map(v => {
    if (v === 'ãã®ä»–') { const o = getVal('q6-other-text'); return o ? `ãã®ä»–ï¼ˆ${o}ï¼‰` : 'ãã®ä»–'; }
    return v;
  });
}
function getQ12Values() {
  return getChecks('q12').map(v => {
    if (v === 'ãã®ä»–') { const o = getVal('q12-other-text'); return o ? `ãã®ä»–ï¼ˆ${o}ï¼‰` : 'ãã®ä»–'; }
    return v;
  });
}

function showFeedback(id, msg, type) {
  const el = document.getElementById(`fb-${id}`);
  if (!el) return;
  el.textContent = msg;
  el.className = `feedback-box feedback-${type} show`;
}
function hideFeedback(id) {
  const el = document.getElementById(`fb-${id}`);
  if (el) { el.className = 'feedback-box'; el.textContent = ''; }
}
function highlightSelected(groupId) {
  document.querySelectorAll(`#${groupId} label`).forEach(lbl => {
    lbl.classList.toggle('selected', lbl.querySelector('input').checked);
  });
}
function highlightChecked(groupId) {
  document.querySelectorAll(`#${groupId} label`).forEach(lbl => {
    lbl.classList.toggle('selected', lbl.querySelector('input').checked);
  });
}
function toggleOtherInput(checkId, wrapId) {
  const checked = document.getElementById(checkId).checked;
  const wrap = document.getElementById(wrapId);
  wrap.classList.toggle('show', checked);
  if (!checked) { const ta = wrap.querySelector('textarea'); if (ta) ta.value = ''; }
}

function updateProgress() {
  const items = [
    getVal('q1'), getVal('q2'), getVal('q2b'),
    getRadio('q3'), getRadio('q4'),
    getRadio('q5'), getChecks('q6').length > 0 ? '1' : '',
    getVal('q7'), getVal('q8'), getChecks('q9').length > 0 ? '1' : '',
    getVal('q10'), getRadio('q11'), getChecks('q12').length > 0 ? '1' : '', getVal('q13')
  ];
  const filled = items.filter(v => v !== '').length;
  document.getElementById('progress-label').textContent = `${filled} / 14 é …ç›®å…¥åŠ›æ¸ˆã¿`;
  document.getElementById('progressFill').style.width = `${Math.round(filled / 14 * 100)}%`;
}
document.addEventListener('change', updateProgress);
document.addEventListener('input',  updateProgress);

function onSelectChange(id) {
  const v = getVal(id);
  if (v) showFeedback(id, `âœ… ã€Œ${v}ã€ã§ç™»éŒ²ã—ã¾ã™ã€‚`, 'good');
  else   hideFeedback(id);
}

function onTextInput(id) {
  const v = getVal(id);
  if (!v) { hideFeedback(id); return; }
  if (isNGName(v)) { showFeedback(id, 'âš ï¸ åŒ¿åã§ã®å—ä»˜ã¯ã§ãã¾ã›ã‚“ã€‚ãŠåå‰ã‚’ãƒ•ãƒ«ãƒãƒ¼ãƒ ã§ã”è¨˜å…¥ãã ã•ã„ã€‚', 'neutral'); return; }
  if (v.length < 2) { showFeedback(id, 'âœï¸ ãŠåå‰ã‚’ãƒ•ãƒ«ãƒãƒ¼ãƒ ã§ã”è¨˜å…¥ãã ã•ã„ã€‚', 'neutral'); return; }
  showFeedback(id, `âœ… ${v} ã•ã‚“ã€ã”å”åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚`, 'good');
}

function onEmailInput(id) {
  const v = getVal(id);
  if (!v) { hideFeedback(id); return; }
  const isEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
  if (isEmail) { showFeedback(id, `âœ… ã€Œ${v}ã€ã«ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚`, 'good'); }
  else { showFeedback(id, 'âš ï¸ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šyamada@example.comï¼‰', 'neutral'); }
}

function onRadioChange(name) {
  highlightSelected(name);
  const v = getRadio(name);
  const feedbackMap = {
    q3: {
      'åŒ»å¸«':'ğŸ©º åŒ»å¸«ã®è¦–ç‚¹ã‹ã‚‰ã®ã”å›ç­”ã€å¤§å¤‰å‚è€ƒã«ãªã‚Šã¾ã™ã€‚',
      'çœ‹è­·å¸«':'ğŸ’‰ çœ‹è­·å¸«ã•ã‚“ã®ç¾å ´ã®æƒ…å ±ã‚’ãŠèã‹ã›ãã ã•ã„ã€‚',
      'è–¬å‰¤å¸«':'ğŸ’Š è–¬å‰¤å¸«ã•ã‚“ã®å°‚é–€çš„ãªè¦–ç‚¹ã§ãŠç­”ãˆãã ã•ã„ã€‚',
      'è‡¨åºŠå·¥å­¦æŠ€å£«':'âš™ï¸ æ©Ÿå™¨ãƒ»ã‚·ã‚¹ãƒ†ãƒ ç³»ã®ç¾å ´çŠ¶æ³ã‚’ãŠèã‹ã›ãã ã•ã„ã€‚',
      'ç†å­¦ç™‚æ³•å£«ãƒ»ä½œæ¥­ç™‚æ³•å£«':'ğŸƒ ãƒªãƒãƒ“ãƒªç¾å ´ã®çŠ¶æ³ã‚’ãŠèã‹ã›ãã ã•ã„ã€‚',
      'äº‹å‹™è·':'ğŸ“‹ äº‹å‹™ãƒ»ç®¡ç†ç³»ã®ç¾å ´çŠ¶æ³ã‚‚ãŠèã‹ã›ãã ã•ã„ã€‚',
      'ãã®ä»–':'ğŸ‘¤ ã©ã®ã‚ˆã†ãªç«‹å ´ã‹ã‚‰ã®ã”å›ç­”ã‚‚ãŠå¾…ã¡ã—ã¦ã„ã¾ã™ã€‚'
    },
    q4: {
      'æ‚£è€…ã•ã‚“':'ğŸ¥ æ‚£è€…ã•ã‚“ã¸ã®å½±éŸ¿ã«ã¤ã„ã¦è©³ã—ããŠèã‹ã›ãã ã•ã„ã€‚',
      'è‡ªåˆ†è‡ªèº«ãƒ»è‡ªéƒ¨ç½²ã®ã‚¹ã‚¿ãƒƒãƒ•':'ğŸ‘¥ ç¾å ´ã‚¹ã‚¿ãƒƒãƒ•ã®çŠ¶æ³ã‚’è©³ã—ããŠèã‹ã›ãã ã•ã„ã€‚',
      'ä»–éƒ¨ç½²ã®ã‚¹ã‚¿ãƒƒãƒ•':'ğŸ¤ ä»–éƒ¨ç½²ã¨ã®é–¢é€£ã«ã¤ã„ã¦ã‚‚æ•™ãˆã¦ãã ã•ã„ã€‚',
      'ç—…é™¢å…¨ä½“':'ğŸ¢ ç—…é™¢å…¨ä½“ã«é–¢ã‚ã‚‹çŠ¶æ³ã§ã™ã­ã€‚'
    },
    q5: {
      'æ¯æ—¥è¤‡æ•°å›':'ğŸ”´ æ¯æ—¥è¤‡æ•°å›ç™ºç”Ÿã—ã¦ã„ã‚‹ã®ã§ã™ã­ã€‚è¨˜éŒ²ã—ã¦ãŠãã¾ã™ã€‚',
      'æ¯æ—¥1å›ç¨‹åº¦':'ğŸŸ  æ¯æ—¥ç™ºç”Ÿã—ã¦ã„ã‚‹çŠ¶æ³ã§ã™ã­ã€‚',
      'é€±ã«æ•°å›':'ğŸŸ¡ é€±ã«æ•°å›ã®ç™ºç”ŸçŠ¶æ³ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚',
      'æœˆã«æ•°å›':'ğŸŸ¢ æœˆã«æ•°å›ã®ç™ºç”ŸçŠ¶æ³ã§ã™ã­ã€‚',
      'ç¨€ã ãŒç™ºç”Ÿã™ã‚‹ã¨é‡å¤§':'âš ï¸ ãƒã‚¤ãƒªã‚¹ã‚¯ãªäº‹è±¡ã¨ã—ã¦è¨˜éŒ²ã—ã¾ã™ã€‚'
    },
    q11: {
      'æ—¢å­˜ã®åŒ»ç™‚æ©Ÿå™¨ãƒ»å™¨å…·ã‚’ä½¿ç”¨':'ğŸ”§ æ—¢å­˜ã®æ©Ÿå™¨ãƒ»å™¨å…·ã‚’ä½¿ç”¨ã—ãŸå¯¾å¿œã§ã™ã­ã€‚',
      'æ—¢å­˜ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ»é›»å­ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨':'ğŸ’» æ—¢å­˜ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ»ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ãŸå¯¾å¿œã§ã™ã­ã€‚',
      'æ—¢å­˜è£½å“ã‚’ãã®ã¾ã¾ä½¿ç”¨ï¼ˆæ¨™æº–çš„ãªä½¿ã„æ–¹ï¼‰':'ğŸ“¦ æ¨™æº–çš„ãªä½¿ã„æ–¹ã§ã®å¯¾å¿œã§ã™ã­ã€‚',
      'ç¾è¡Œã®é‹ç”¨ãƒ«ãƒ¼ãƒ«ãƒ»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã«å¾“ã£ã¦å¯¾å¿œ':'ğŸ“„ ç¾è¡Œã®ãƒ«ãƒ¼ãƒ«ãƒ»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã«æ²¿ã£ãŸå¯¾å¿œã§ã™ã­ã€‚'
    }
  };
  const msg = (feedbackMap[name] || {})[v];
  if (msg) showFeedback(name, msg, 'good');
}

function onCheckChange(name) {
  highlightChecked(name);
  const checks = getChecks(name);
  if (name === 'q6') {
    if (checks.length === 0) { hideFeedback('q6'); return; }
    const hasOther = checks.includes('ãã®ä»–');
    if (checks.length === 1 && hasOther)
      showFeedback('q6', 'ğŸ“ ä¸‹ã®æ¬„ã«å…·ä½“çš„ãªå†…å®¹ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚', 'tip');
    else if (checks.length === 1)
      showFeedback('q6', `âœ… ã€Œ${checks[0]}ã€ã‚’é¸æŠã—ã¾ã—ãŸã€‚ä»–ã«ã‚‚è©²å½“ã™ã‚‹ã‚‚ã®ãŒã‚ã‚Œã°è¿½åŠ ã—ã¦ãã ã•ã„ã€‚`, 'good');
    else if (checks.length >= 3)
      showFeedback('q6', `ğŸ“Š ${checks.length}ã¤ã®å½±éŸ¿ãƒ»è² æ‹…ãŒç¢ºèªã•ã‚Œã¾ã—ãŸã€‚è¨˜éŒ²ã—ã¾ã™ã€‚`, 'tip');
    else
      showFeedback('q6', `âœ… ${checks.length}ã¤é¸æŠæ¸ˆã¿ã€‚ä»–ã«ã‚‚ã‚ã‚Œã°è¿½åŠ ã—ã¦ãã ã•ã„ã€‚`, 'good');
  }
  if (name === 'q9') {
    if (checks.length === 0) { hideFeedback('q9'); return; }
    showFeedback('q9', `âœ… ${checks.length}ã¤ã®èª²é¡Œã‚’é¸æŠã—ã¾ã—ãŸã€‚`, 'good');
  }
  if (name === 'q12') {
    if (checks.length === 0) { hideFeedback('q12'); return; }
    const hasOther = checks.includes('ãã®ä»–');
    if (checks.length === 1 && hasOther)
      showFeedback('q12', 'ğŸ“ ä¸‹ã®æ¬„ã«è¦³å¯Ÿãƒ»æ¸¬å®šé …ç›®ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚', 'tip');
    else if (checks.length === 1)
      showFeedback('q12', `âœ… ã€Œ${checks[0]}ã€ã‚’é¸æŠã—ã¾ã—ãŸã€‚`, 'good');
    else if (checks.length >= 3)
      showFeedback('q12', `ğŸ“Š ${checks.length}ã¤ã®é …ç›®ã‚’è¦³å¯Ÿãƒ»æ¸¬å®šã—ã¦ã„ã‚‹ã®ã§ã™ã­ã€‚`, 'good');
    else
      showFeedback('q12', `âœ… ${checks.length}ã¤ã®é …ç›®ã‚’é¸æŠã—ã¾ã—ãŸã€‚`, 'good');
  }
}

function onTextareaInput(id) {
  const v = getVal(id); if (!v) { hideFeedback(id); return; }
  const len = v.length;
  if (id === 'q7') {
    if (len < 20)      showFeedback('q7', 'âœï¸ ã‚‚ã†å°‘ã—è©³ã—ãæ•™ãˆã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿã€Œã„ã¤ãƒ»ã©ã“ã§ãƒ»èª°ãŒãƒ»ä½•ãŒèµ·ãã‚‹ã€ã‚’æ„è­˜ã™ã‚‹ã¨ä¼ã‚ã‚Šã‚„ã™ã„ã§ã™ã€‚', 'neutral');
    else if (len < 50) showFeedback('q7', 'ğŸ“ ã„ã„æ„Ÿã˜ã§ã™ã€‚ã‚‚ã†å°‘ã—å…·ä½“çš„ãªçŠ¶æ³ã‚’åŠ ãˆã¦ãã ã•ã„ã€‚', 'tip');
    else               showFeedback('q7', 'âœ… å…·ä½“çš„ã§åˆ†ã‹ã‚Šã‚„ã™ã„å ´é¢æå†™ã§ã™ã€‚', 'good');
  }
  if (id === 'q8') {
    if (len < 15) showFeedback('q8', 'âœï¸ ç¾åœ¨ã®å¯¾å¿œã‚’å°‘ã—è©³ã—ãæ•™ãˆã¦ãã ã•ã„ã€‚', 'neutral');
    else          showFeedback('q8', 'âœ… ç¾åœ¨ã®å¯¾å¿œçŠ¶æ³ãŒä¼ã‚ã‚Šã¾ã™ã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚', 'good');
  }
  if (id === 'q13') {
    const hasNum = /[0-9ï¼-ï¼™]/.test(v);
    if (hasNum) showFeedback('q13', 'ğŸ¯ æ•°å€¤ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚å®šé‡çš„ãªãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦è¨˜éŒ²ã—ã¾ã™ã€‚', 'good');
    else        showFeedback('q13', 'ğŸ’¡ å¯èƒ½ã§ã‚ã‚Œã°æ•°å€¤ã‚„é »åº¦ã‚’åŠ ãˆã¦ã„ãŸã ã‘ã‚‹ã¨å‚è€ƒã«ãªã‚Šã¾ã™ã€‚', 'tip');
  }
}

function onCurrentPracticeInput() {
  const v = getVal('q10'); if (!v) { hideFeedback('q10'); return; }
  const len = v.length;
  if (len < 20)       showFeedback('q10', 'âœï¸ ç¾åœ¨ã®å¯¾å¿œæ–¹æ³•ã‚’ã‚‚ã†å°‘ã—è©³ã—ãæ•™ãˆã¦ãã ã•ã„ã€‚', 'neutral');
  else if (len < 60)  showFeedback('q10', 'ğŸ“ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚å…·ä½“çš„ãªæ‰‹é †ã‚„é »åº¦ã‚’åŠ ãˆã‚‹ã¨ã•ã‚‰ã«å‚è€ƒã«ãªã‚Šã¾ã™ã€‚', 'tip');
  else if (len < 120) showFeedback('q10', 'âœ… å…·ä½“çš„ãªå†…å®¹ãŒä¼ã‚ã‚Šã¾ã™ã€‚', 'good');
  else                showFeedback('q10', 'âœ… å¤§å¤‰è©³ç´°ãªã”å›ç­”ã§ã™ã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚', 'good');
}

function validate() {
  const required = [
    { val: getVal('q1'),                            label: 'Q1 æ‰€å±éƒ¨ç½²' },
    { val: getVal('q2'),                            label: 'Q2 æ°å' },
    { val: getVal('q2b'),                           label: 'Q2-b è¿”ä¿¡ç”¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹' },
    { val: getRadio('q3'),                          label: 'Q3 è·ç¨®' },
    { val: getRadio('q4'),                          label: 'Q4 å½±éŸ¿ã‚’å—ã‘ã¦ã„ã‚‹å¯¾è±¡' },
    { val: getRadio('q5'),                          label: 'Q5 ç™ºç”Ÿé »åº¦' },
    { val: getChecks('q6').length > 0 ? '1' : '',  label: 'Q6 å½±éŸ¿ãƒ»è² æ‹…ã®ç¨®é¡' },
    { val: getVal('q10'),                           label: 'Q10 ç¾åœ¨ã®æ¥­å‹™ãƒ»ã‚±ã‚¢ã®ã‚„ã‚Šæ–¹' },
    { val: getRadio('q11'),                         label: 'Q11 å¯¾å¿œæ–¹æ³•ã®åˆ†é¡' },
    { val: getChecks('q12').length > 0 ? '1' : '', label: 'Q12 è¦³å¯Ÿãƒ»æ¸¬å®šé …ç›®' },
  ];
  const missing = required.filter(r => !r.val).map(r => r.label);
  if (missing.length > 0) { alert('âš ï¸ ä»¥ä¸‹ã®å¿…é ˆé …ç›®ãŒæœªå…¥åŠ›ã§ã™ï¼š\n\n' + missing.join('\n')); return false; }
  const nameVal = getVal('q2');
  if (isNGName(nameVal)) { alert('âš ï¸ åŒ¿åã§ã®å—ä»˜ã¯ã§ãã¾ã›ã‚“ã€‚\nãŠåå‰ã‚’ãƒ•ãƒ«ãƒãƒ¼ãƒ ã§ã”è¨˜å…¥ãã ã•ã„ã€‚'); return false; }
  const emailVal = getVal('q2b');
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailVal)) { alert('âš ï¸ è¿”ä¿¡ç”¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚\nä¾‹ï¼šyamada@example.com'); return false; }
  return true;
}

function buildText() {
  const now = new Date().toLocaleString('ja-JP');
  const q6  = getQ6Values().join(' / ')  || 'ï¼ˆæœªé¸æŠï¼‰';
  const q9  = getChecks('q9').join(' / ')|| 'ï¼ˆæœªé¸æŠï¼‰';
  const q12 = getQ12Values().join(' / ') || 'ï¼ˆæœªé¸æŠï¼‰';
  return `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ ç¾å ´ã®çŠ¶æ³èª¿æŸ»ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ç¾¤ï¼‰
é€ä¿¡æ—¥æ™‚ï¼š${now}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€ç¬¬1ãƒ–ãƒ­ãƒƒã‚¯ï¼šåŸºæœ¬æƒ…å ±ã€‘
Q1.   æ‰€å±éƒ¨ç½²              ï¼š ${getVal('q1')   || 'ï¼ˆæœªå…¥åŠ›ï¼‰'}
Q2.   æ°å                  ï¼š ${getVal('q2')   || 'ï¼ˆæœªå…¥åŠ›ï¼‰'}
Q2-b. è¿”ä¿¡ç”¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹   ï¼š ${getVal('q2b')  || 'ï¼ˆæœªå…¥åŠ›ï¼‰'}
Q3.   è·ç¨®                  ï¼š ${getRadio('q3') || 'ï¼ˆæœªé¸æŠï¼‰'}

ã€ç¬¬2ãƒ–ãƒ­ãƒƒã‚¯ï¼šç¾å ´ã®çŠ¶æ³ã€‘
Q4. ä¸»ã«å½±éŸ¿ã‚’å—ã‘ã¦ã„ã‚‹å¯¾è±¡ ï¼š ${getRadio('q4') || 'ï¼ˆæœªé¸æŠï¼‰'}
Q5. ç™ºç”Ÿé »åº¦                ï¼š ${getRadio('q5') || 'ï¼ˆæœªé¸æŠï¼‰'}
Q6. ç¾åœ¨ã®å½±éŸ¿ãƒ»è² æ‹…         ï¼š ${q6}
Q7. å…·ä½“çš„ãªå ´é¢             ï¼š
${getVal('q7') || 'ï¼ˆæœªè¨˜å…¥ï¼‰'}

ã€ç¬¬3ãƒ–ãƒ­ãƒƒã‚¯ï¼šç¾åœ¨ã®å¯¾å¿œã¨ãã®çŠ¶æ³ã€‘
Q8. ç¾åœ¨ã®å¯¾å¿œæ–¹æ³•  ï¼š
${getVal('q8') || 'ï¼ˆæœªè¨˜å…¥ï¼‰'}
Q9. å¯¾å¿œã«ä¼´ã†èª²é¡Œ  ï¼š ${q9}

ã€ç¬¬4ãƒ–ãƒ­ãƒƒã‚¯ï¼šæ¥­å‹™ãƒ»ã‚±ã‚¢ã®å®Ÿæ…‹ã€‘
Q10. ç¾åœ¨ã®æ¥­å‹™ãƒ»ã‚±ã‚¢ã®ã‚„ã‚Šæ–¹ ï¼š
${getVal('q10') || 'ï¼ˆæœªè¨˜å…¥ï¼‰'}
Q11. å¯¾å¿œæ–¹æ³•ã®åˆ†é¡           ï¼š ${getRadio('q11') || 'ï¼ˆæœªé¸æŠï¼‰'}

ã€ç¬¬5ãƒ–ãƒ­ãƒƒã‚¯ï¼šç¾çŠ¶ã®è©•ä¾¡ãƒ»æ¸¬å®šã€‘
Q12. è¦³å¯Ÿãƒ»æ¸¬å®šé …ç›®  ï¼š ${q12}
Q13. å®šé‡çš„ãªç¾çŠ¶å€¤  ï¼š
${getVal('q13') || 'ï¼ˆæœªè¨˜å…¥ï¼‰'}
Q14. æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«    ï¼š â€»å‚è€ƒè³‡æ–™ã¯ã“ã®ãƒ¡ãƒ¼ãƒ«ã«ç›´æ¥æ·»ä»˜ã—ã¦ãã ã•ã„

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
`.trim();
}

function showPreview() {
  if (!validate()) return;
  document.getElementById('previewText').textContent = buildText();
  document.getElementById('previewModal').classList.add('active');
}

function closePreviewAndThank() {
  document.getElementById('previewModal').classList.remove('active');
  const name  = getVal('q2');
  const email = getVal('q2b');
  const label = name ? `${name} ã•ã‚“ã€` : '';
  document.getElementById('thank-name-label').textContent = label;
  document.getElementById('thank-reply-email').textContent = email || 'ï¼ˆæœªå…¥åŠ›ï¼‰';
  document.getElementById('thankModal').classList.add('active');
}
function closeThankModal() {
  document.getElementById('thankModal').classList.remove('active');
}
function startNewEntry() {
  document.getElementById('thankModal').classList.remove('active');
  resetFormSilent();
}

function sendMail() {
  const dept  = getVal('q1')    || 'ä¸æ˜';
  const name  = getVal('q2')    || 'ï¼ˆæœªå…¥åŠ›ï¼‰';
  const email = getVal('q2b')   || 'æœªå…¥åŠ›';
  const cat   = getRadio('q11') || 'æœªé¸æŠ';
  const subject = encodeURIComponent(`ã€ç¾çŠ¶èª¿æŸ»ã€‘${cat}ï½œ${dept} ${name}`);
  const body    = encodeURIComponent(
    buildText() + '\n\n' +
    `ã€è¿”ä¿¡å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€‘${email}\n` +
    'â€»å‚è€ƒè³‡æ–™ãŒã‚ã‚‹å ´åˆã¯ã“ã®ãƒ¡ãƒ¼ãƒ«ã«ç›´æ¥æ·»ä»˜ã—ã¦ãã ã•ã„ã€‚'
  );
  window.location.href = `mailto:${MAIL_TO}?subject=${subject}&body=${body}`;
}

function downloadTxt() {
  const email = getVal('q2b') || 'æœªå…¥åŠ›';
  const text  = buildText() + `\n\nã€è¿”ä¿¡å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€‘${email}`;
  const now   = new Date();
  const ts    = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}`;
  const name  = getVal('q2') || 'unknown';
  const blob  = new Blob([text], { type: 'text/plain;charset=utf-8' });
  const a     = document.createElement('a');
  a.href      = URL.createObjectURL(blob);
  a.download  = `control_${ts}_${name}.txt`;
  a.click();
}

function resetFormSilent() {
  document.getElementById('ideaForm').reset();
  document.querySelectorAll('.feedback-box').forEach(el => {
    el.className = 'feedback-box'; el.textContent = '';
  });
  document.querySelectorAll('.radio-group label, .check-group label').forEach(lbl => {
    lbl.classList.remove('selected');
  });
  ['q6-other-wrap', 'q12-other-wrap'].forEach(id => {
    document.getElementById(id).classList.remove('show');
  });
  showStep(0);
  updateProgress();
}
function resetForm() {
  if (!confirm('âš ï¸ å…¥åŠ›å†…å®¹ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;
  resetFormSilent();
}

function showEndScreen() {
  if (!confirm('ãƒ•ã‚©ãƒ¼ãƒ ã‚’çµ‚äº†ã—ã¾ã™ã€‚å…¥åŠ›å†…å®¹ã¯ã‚¯ãƒªã‚¢ã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;
  hideFormUI();
  document.getElementById('endScreen').classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
  resetFormSilent();
}

function restartFromEnd() {
  document.getElementById('endScreen').classList.remove('active');
  showFormUI();
  showStep(0);
  updateProgress();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

updateProgress();
</script>
</body>
</html>
