<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŒ»ç™‚ã‚’ã‚ˆãã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ï¼†ãŠå›°ã‚Šã”ã¨ææ¡ˆãƒ•ã‚©ãƒ¼ãƒ ï¼ˆå¯¾ç…§ç¾¤ï¼‰</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
  background: #f2f8f5;
  color: #333;
  padding: 20px;
  min-height: 100vh;
}
.container { max-width: 720px; margin: 0 auto; }

/* ===== ãƒ˜ãƒƒãƒ€ãƒ¼ ===== */
.header {
  background: linear-gradient(135deg, #2d7a5f, #4caf88);
  color: white;
  padding: 24px 28px;
  border-radius: 12px 12px 0 0;
  text-align: center;
}
.header h1 { font-size: 1.4em; margin-bottom: 6px; }
.header p  { font-size: 0.85em; opacity: 0.88; }
.header-sub {
  margin-top: 10px;
  font-size: 0.80em;
  opacity: 0.80;
  background: rgba(255,255,255,0.15);
  border-radius: 8px;
  padding: 8px 14px;
  line-height: 1.7;
}

/* ===== ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ ===== */
.stepper {
  display: flex;
  background: white;
  padding: 14px 20px;
  gap: 4px;
  align-items: center;
  border-bottom: 1px solid #d4eddf;
  overflow-x: auto;
}
.step-dot {
  display: flex; flex-direction: column; align-items: center;
  gap: 4px; flex: 1; min-width: 44px;
}
.step-circle {
  width: 30px; height: 30px;
  border-radius: 50%;
  background: #d4eddf;
  color: #7fba9e;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.75em; font-weight: bold;
  transition: all 0.4s;
}
.step-circle.done   { background: #4caf88; color: white; }
.step-circle.active { background: #2d7a5f; color: white; box-shadow: 0 0 0 4px #b0ddc8; }
.step-label { font-size: 0.65em; color: #888; text-align: center; }
.step-label.active { color: #2d7a5f; font-weight: bold; }
.step-line { height: 2px; background: #d4eddf; flex: 0.3; border-radius: 1px; }
.step-line.done { background: #4caf88; }

/* ===== ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ ===== */
.progress-bar-wrap {
  background: #edf7f2;
  padding: 8px 20px;
  display: flex; align-items: center; gap: 10px;
  font-size: 0.82em; color: #2d7a5f;
}
.progress-bar-bg {
  flex: 1; height: 8px;
  background: #a8d8bb; border-radius: 4px; overflow: hidden;
}
.progress-bar-fill {
  height: 100%; width: 0%;
  background: linear-gradient(90deg, #4caf88, #82d4a8);
  border-radius: 4px; transition: width 0.5s ease;
}

/* ===== ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼ï¼ˆCSSæ®‹å­˜ãƒ»HTMLéè¡¨ç¤ºï¼‰ ===== */
.navigator {
  display: flex; align-items: flex-start; gap: 12px;
  background: white;
  padding: 16px 20px;
  border-bottom: 1px solid #edf7f2;
  animation: fadeSlideIn 0.4s ease;
}
.nav-avatar {
  font-size: 2.2em; flex-shrink: 0;
  animation: bounce 1s ease infinite alternate;
}
@keyframes bounce {
  from { transform: translateY(0); }
  to   { transform: translateY(-4px); }
}
.nav-bubble {
  background: #edf7f2;
  border-radius: 0 12px 12px 12px;
  padding: 10px 14px;
  font-size: 0.88em;
  line-height: 1.6;
  color: #2d7a5f;
  position: relative;
  flex: 1;
}
.nav-bubble::before {
  content: '';
  position: absolute; left: -8px; top: 10px;
  border: 8px solid transparent;
  border-right-color: #edf7f2;
  border-left: 0;
}

/* ===== ã‚¹ãƒ†ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ ===== */
.block {
  background: white;
  border-left: 5px solid #4caf88;
  border-radius: 0 0 8px 8px;
  padding: 24px 28px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  display: none;
  animation: fadeSlideIn 0.45s ease;
}
.block.active { display: block; }
@keyframes fadeSlideIn {
  from { opacity: 0; transform: translateY(18px); }
  to   { opacity: 1; transform: translateY(0); }
}

.block-title {
  font-size: 1.05em; font-weight: bold;
  color: #2d7a5f; margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid #d4eddf;
  display: flex; align-items: center; gap: 8px;
}
.block-title .badge {
  font-size: 0.72em; background: #4caf88; color: white;
  padding: 2px 10px; border-radius: 10px;
}

/* ===== è¨­å• ===== */
.q-block { margin-bottom: 24px; }
.q-label {
  font-size: 0.93em; font-weight: bold;
  margin-bottom: 6px; display: block; color: #2c3e50;
}
.q-label .req { color: #e57373; font-size: 0.82em; margin-left: 4px; }
.q-hint { font-size: 0.79em; color: #888; margin-bottom: 8px; }

/* ===== ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ ===== */
.feedback-box {
  margin-top: 8px; padding: 8px 12px;
  border-radius: 6px; font-size: 0.82em;
  line-height: 1.5; min-height: 0;
  transition: all 0.3s; display: none;
}
.feedback-box.show { display: block; }
.feedback-good    { background: #edf7f2; color: #2d7a5f; border-left: 3px solid #4caf88; }
.feedback-neutral { background: #fef9e7; color: #9a7d0a; border-left: 3px solid #f0c040; }
.feedback-tip     { background: #e8f5f0; color: #2d7a5f; border-left: 3px solid #82d4a8; }

/* ===== ãƒ•ã‚©ãƒ¼ãƒ éƒ¨å“ ===== */
select, input[type="text"], textarea {
  width: 100%; padding: 10px 13px;
  border: 1.5px solid #c5d9cc; border-radius: 7px;
  font-size: 0.92em; font-family: inherit;
  background: #fdfefe; transition: border 0.2s, box-shadow 0.2s;
}
select:focus, input:focus, textarea:focus {
  outline: none; border-color: #4caf88;
  background: #edf7f2; box-shadow: 0 0 0 3px rgba(76,175,136,0.15);
}
textarea { resize: vertical; min-height: 80px; }

/* ===== ãƒ©ã‚¸ã‚ªãƒ»ãƒã‚§ãƒƒã‚¯ ===== */
.radio-group, .check-group {
  display: flex; flex-direction: column; gap: 8px;
}
.radio-group label, .check-group label {
  display: flex; align-items: flex-start; gap: 10px;
  font-size: 0.90em; cursor: pointer;
  padding: 9px 14px;
  border: 1.5px solid #d4eddf; border-radius: 8px;
  transition: all 0.2s; background: #fdfefe;
}
.radio-group label:hover, .check-group label:hover {
  background: #edf7f2; border-color: #a8d8bb;
}
.radio-group label.selected, .check-group label.selected {
  background: #edf7f2; border-color: #4caf88;
  box-shadow: 0 0 0 2px rgba(76,175,136,0.18);
}
.radio-group input, .check-group input {
  margin-top: 2px; accent-color: #4caf88; flex-shrink: 0;
}

/* ===== ãã®ä»–ãƒ†ã‚­ã‚¹ãƒˆ ===== */
.other-input-wrap {
  display: none;
  margin-top: 8px;
  padding: 10px 14px;
  background: #f4fbf7;
  border-radius: 6px;
  border: 1.5px dashed #a8d8bb;
  animation: fadeSlideIn 0.3s ease;
}
.other-input-wrap.show { display: block; }
.other-input-wrap textarea { min-height: 60px; background: white; }

/* ===== ãƒœã‚¿ãƒ³ ===== */
.nav-btn-row {
  display: flex; gap: 12px;
  justify-content: space-between;
  margin-top: 28px; flex-wrap: wrap;
}
.btn-prev    { background: #dce5df; color: #5a6b5e; }
.btn-next    { background: #4caf88; color: white; flex: 1; }
.btn-preview { background: #2d7a5f; color: white; flex: 1; }
.btn-reset   { background: #b2c5ba; color: white; }
.btn-finish  { background: #2d7a5f; color: white; }
button {
  padding: 12px 22px; border: none; border-radius: 8px;
  font-size: 0.95em; font-weight: bold; cursor: pointer;
  font-family: inherit; transition: opacity 0.2s, transform 0.1s;
}
button:hover  { opacity: 0.88; }
button:active { transform: scale(0.97); }

/* ===== ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ ===== */
.check-anim {
  display: inline-block;
  animation: popIn 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
}
@keyframes popIn {
  0%   { transform: scale(0); opacity: 0; }
  80%  { transform: scale(1.3); }
  100% { transform: scale(1); opacity: 1; }
}

/* ===== ãƒ¢ãƒ¼ãƒ€ãƒ«å…±é€š ===== */
.modal-overlay {
  display: none; position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.50); z-index: 1000;
  align-items: center; justify-content: center;
}
.modal-overlay.active { display: flex; }
.modal {
  background: white; border-radius: 14px;
  padding: 28px; max-width: 640px; width: 94%;
  max-height: 88vh; overflow-y: auto;
  box-shadow: 0 10px 40px rgba(0,0,0,0.18);
  animation: fadeSlideIn 0.35s ease;
}
.modal h2 { color: #2d7a5f; margin-bottom: 12px; font-size: 1.1em; }
.modal pre {
  background: #f4f8f6; padding: 14px; border-radius: 8px;
  font-size: 0.81em; white-space: pre-wrap; line-height: 1.75;
  font-family: 'Courier New', monospace; border: 1px solid #d4eddf;
}
.modal-btn-row { display: flex; gap: 10px; margin-top: 16px; flex-wrap: wrap; }
.btn-mail  { background: #4caf88; color: white; }
.btn-close { background: #b2c5ba; color: white; }

/* ===== æ„Ÿè¬ãƒ¢ãƒ¼ãƒ€ãƒ« ===== */
.thank-modal-overlay {
  display: none; position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.55); z-index: 2000;
  align-items: center; justify-content: center;
}
.thank-modal-overlay.active { display: flex; }
.thank-modal {
  background: white; border-radius: 20px;
  padding: 44px 36px; max-width: 440px; width: 92%;
  text-align: center;
  box-shadow: 0 12px 48px rgba(0,0,0,0.20);
  animation: thankPop 0.5s cubic-bezier(0.175,0.885,0.32,1.275);
}
@keyframes thankPop {
  0%   { opacity: 0; transform: scale(0.7); }
  80%  { transform: scale(1.04); }
  100% { opacity: 1; transform: scale(1); }
}
.thank-icon {
  font-size: 4em; margin-bottom: 16px;
  animation: iconBounce 0.6s 0.3s cubic-bezier(0.175,0.885,0.32,1.275) both;
}
@keyframes iconBounce {
  0%   { transform: scale(0) rotate(-20deg); opacity: 0; }
  80%  { transform: scale(1.2) rotate(5deg); }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}
.thank-title {
  font-size: 1.45em; font-weight: bold;
  color: #2d7a5f; margin-bottom: 12px;
}
.thank-body {
  font-size: 0.92em; color: #555;
  line-height: 1.9; margin-bottom: 16px;
}
.thank-body strong { color: #4caf88; }
.thank-reply-box {
  background: #edf7f2;
  border-left: 4px solid #4caf88;
  border-radius: 8px;
  padding: 12px 16px;
  margin: 0 0 24px;
  font-size: 0.88em;
  color: #2d7a5f;
  text-align: left;
  line-height: 1.7;
}
.thank-reply-box .reply-email {
  font-weight: bold;
  word-break: break-all;
  color: #1a5c40;
}
.thank-btn-row { display: flex; flex-direction: column; gap: 10px; }
.btn-new-idea {
  background: linear-gradient(135deg, #2d7a5f, #4caf88);
  color: white; padding: 13px 20px;
  border: none; border-radius: 10px;
  font-size: 0.95em; font-weight: bold;
  cursor: pointer; font-family: inherit;
  transition: opacity 0.2s, transform 0.1s;
}
.btn-new-idea:hover  { opacity: 0.88; }
.btn-new-idea:active { transform: scale(0.97); }
.btn-just-close {
  background: #ecf0f1; color: #777;
  padding: 10px 20px;
  border: none; border-radius: 10px;
  font-size: 0.88em; cursor: pointer; font-family: inherit;
  transition: opacity 0.2s;
}
.btn-just-close:hover { opacity: 0.75; }

/* ===== çµ‚äº†ç”»é¢ ===== */
.end-screen {
  display: none;
  background: white;
  border-radius: 0 0 12px 12px;
  padding: 56px 36px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  animation: fadeSlideIn 0.5s ease;
}
.end-screen.active { display: block; }
.end-icon {
  font-size: 4.5em;
  margin-bottom: 20px;
  animation: iconBounce 0.6s 0.2s cubic-bezier(0.175,0.885,0.32,1.275) both;
}
.end-title {
  font-size: 1.55em; font-weight: bold;
  color: #2d7a5f; margin-bottom: 16px;
}
.end-divider {
  width: 60px; height: 3px;
  background: linear-gradient(90deg, #4caf88, #82d4a8);
  border-radius: 2px; margin: 0 auto 28px;
}
.end-body {
  font-size: 0.95em; color: #555;
  line-height: 2.1; margin-bottom: 36px;
}
.end-body strong { color: #4caf88; }
.btn-restart {
  background: #edf7f2; color: #2d7a5f;
  border: 2px solid #4caf88;
  padding: 12px 32px; border-radius: 8px;
  font-size: 0.93em; font-weight: bold;
  cursor: pointer; font-family: inherit;
  transition: all 0.2s;
}
.btn-restart:hover  { background: #d4eddf; }
.btn-restart:active { transform: scale(0.97); }

@media(max-width:600px){
  .nav-btn-row { flex-direction: column; }
  button { width: 100%; }
  .stepper { gap: 2px; padding: 10px 8px; }
  .step-label { font-size: 0.58em; }
  .end-screen { padding: 40px 20px; }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ğŸ’¡ åŒ»ç™‚ã‚’ã‚ˆãã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ï¼†ãŠå›°ã‚Šã”ã¨ææ¡ˆãƒ•ã‚©ãƒ¼ãƒ </h1>
    <p>ç¾å ´ã®æ°—ã¥ãã‚„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ã‚«ã‚¿ãƒã«ã—ã¾ã™ã€‚3ã€œ5åˆ†ã§å…¥åŠ›ã§ãã¾ã™ã€‚</p>
    <div class="header-sub">
      ğŸ“£ è·ç¨®ã‚„çµŒé¨“å¹´æ•°ã¯é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
      ã€Œãªã‚“ã¨ãªãä¸ä¾¿ã ãªã€ã¨æ„Ÿã˜ã¦ã„ã‚‹ã“ã¨ã‚„ã€ã€Œã“ã†ã ã£ãŸã‚‰ã„ã„ã®ã«ã€ã¨ã„ã†ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ã€<br>
      ãœã²æ°—è»½ã«æ•™ãˆã¦ãã ã•ã„ã€‚å°ã•ãªå£°ãŒã€å¤§ããªæ”¹å–„ã«ã¤ãªãŒã‚Šã¾ã™ã€‚
    </div>
  </div>

  <!-- ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ -->
  <div class="stepper" id="stepper">
    <div class="step-dot">
      <div class="step-circle active" id="sc0">1</div>
      <div class="step-label active" id="sl0">åŸºæœ¬æƒ…å ±</div>
    </div>
    <div class="step-line" id="line0"></div>
    <div class="step-dot">
      <div class="step-circle" id="sc1">2</div>
      <div class="step-label" id="sl1">å›°ã‚Šã”ã¨</div>
    </div>
    <div class="step-line" id="line1"></div>
    <div class="step-dot">
      <div class="step-circle" id="sc2">3</div>
      <div class="step-label" id="sl2">ä»Šã®å¯¾å¿œ</div>
    </div>
    <div class="step-line" id="line2"></div>
    <div class="step-dot">
      <div class="step-circle" id="sc3">4</div>
      <div class="step-label" id="sl3">ã‚¢ã‚¤ãƒ‡ã‚¢</div>
    </div>
    <div class="step-line" id="line3"></div>
    <div class="step-dot">
      <div class="step-circle" id="sc4">5</div>
      <div class="step-label" id="sl4">æœŸå¾…åŠ¹æœ</div>
    </div>
  </div>

  <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
  <div class="progress-bar-wrap" id="progressWrap">
    <span id="progress-label">0 / 14 é …ç›®å…¥åŠ›æ¸ˆã¿</span>
    <div class="progress-bar-bg">
      <div class="progress-bar-fill" id="progressFill"></div>
    </div>
  </div>

  <form id="ideaForm" novalidate>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—1ï¼šåŸºæœ¬æƒ…å ± -->
    <div class="block active" id="step0">
      <div class="block-title">ğŸ“‹ ç¬¬1ã‚¹ãƒ†ãƒƒãƒ—ï¼šåŸºæœ¬æƒ…å ±</div>
      <div class="q-block">
        <label class="q-label">Q1. æ‰€å±éƒ¨ç½² <span class="req">â˜…å¿…é ˆ</span></label>
        <select id="q1" required onchange="onSelectChange('q1')">
          <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
          <option>GICU</option><option>æ‰‹è¡“å®¤</option><option>å¤–æ¥</option>
          <option>ç—…æ£Ÿ</option><option>ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç§‘</option><option>è–¬å‰¤éƒ¨</option>
          <option>æ”¾å°„ç·šç§‘</option><option>è‡¨åºŠæ¤œæŸ»éƒ¨</option>
          <option>åŒ»ç™‚æƒ…å ±ãƒ»ã‚·ã‚¹ãƒ†ãƒ éƒ¨é–€</option><option>è‡¨åºŠç ”ç©¶æ”¯æ´ã‚»ãƒ³ã‚¿ãƒ¼</option>
          <option>äº‹å‹™éƒ¨é–€</option><option>ãã®ä»–</option>
        </select>
        <div class="feedback-box feedback-good" id="fb-q1"></div>
      </div>
      <div class="q-block">
        <label class="q-label">Q2. æ°å <span class="req">â˜…å¿…é ˆ</span></label>
        <input type="text" id="q2" placeholder="ä¾‹ï¼šå±±ç”° å¤ªéƒ" oninput="onTextInput('q2')" required>
        <div class="feedback-box" id="fb-q2"></div>
      </div>
      <div class="q-block">
        <label class="q-label">Q2-b. è¿”ä¿¡ç”¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span class="req">â˜…å¿…é ˆ</span></label>
        <input type="text" id="q2b" placeholder="ä¾‹ï¼šyamada.taro@example.com" oninput="onEmailInput('q2b')" required>
        <div class="feedback-box" id="fb-q2b"></div>
      </div>
      <div class="q-block">
        <label class="q-label">Q3. è·ç¨® <span class="req">â˜…å¿…é ˆ</span></label>
        <div class="radio-group" id="q3">
          <label><input type="radio" name="q3" value="åŒ»å¸«" onchange="onRadioChange('q3')"> åŒ»å¸«</label>
          <label><input type="radio" name="q3" value="çœ‹è­·å¸«" onchange="onRadioChange('q3')"> çœ‹è­·å¸«</label>
          <label><input type="radio" name="q3" value="è–¬å‰¤å¸«" onchange="onRadioChange('q3')"> è–¬å‰¤å¸«</label>
          <label><input type="radio" name="q3" value="è‡¨åºŠå·¥å­¦æŠ€å£«" onchange="onRadioChange('q3')"> è‡¨åºŠå·¥å­¦æŠ€å£«</label>
          <label><input type="radio" name="q3" value="ç†å­¦ç™‚æ³•å£«ãƒ»ä½œæ¥­ç™‚æ³•å£«" onchange="onRadioChange('q3')"> ç†å­¦ç™‚æ³•å£«ãƒ»ä½œæ¥­ç™‚æ³•å£«</label>
          <label><input type="radio" name="q3" value="äº‹å‹™è·" onchange="onRadioChange('q3')"> äº‹å‹™è·</label>
          <label><input type="radio" name="q3" value="ãã®ä»–" onchange="onRadioChange('q3')"> ãã®ä»–</label>
        </div>
        <div class="feedback-box" id="fb-q3"></div>
      </div>
      <div class="nav-btn-row">
        <button type="button" class="btn-next" onclick="goNext(0)">æ¬¡ã¸ï¼šå›°ã‚Šã”ã¨ã‚’æ•™ãˆã‚‹ â†’</button>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—2ï¼šç¾å ´ã®å›°ã‚Šã”ã¨ -->
    <div class="block" id="step1">
      <div class="block-title">ğŸ” ç¬¬2ã‚¹ãƒ†ãƒƒãƒ—ï¼šç¾å ´ã®å›°ã‚Šã”ã¨</div>
      <div class="q-block">
        <label class="q-label">Q4. èª°ãŒä¸€ç•ªå›°ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ <span class="req">â˜…å¿…é ˆ</span></label>
        <div class="radio-group" id="q4">
          <label><input type="radio" name="q4" value="æ‚£è€…ã•ã‚“" onchange="onRadioChange('q4')"> æ‚£è€…ã•ã‚“</label>
          <label><input type="radio" name="q4" value="è‡ªåˆ†è‡ªèº«ãƒ»è‡ªéƒ¨ç½²ã®ã‚¹ã‚¿ãƒƒãƒ•" onchange="onRadioChange('q4')"> è‡ªåˆ†è‡ªèº«ãƒ»è‡ªéƒ¨ç½²ã®ã‚¹ã‚¿ãƒƒãƒ•</label>
          <label><input type="radio" name="q4" value="ä»–éƒ¨ç½²ã®ã‚¹ã‚¿ãƒƒãƒ•" onchange="onRadioChange('q4')"> ä»–éƒ¨ç½²ã®ã‚¹ã‚¿ãƒƒãƒ•</label>
          <label><input type="radio" name="q4" value="ç—…é™¢å…¨ä½“" onchange="onRadioChange('q4')"> ç—…é™¢å…¨ä½“</label>
        </div>
        <div class="feedback-box" id="fb-q4"></div>
      </div>
      <div class="q-block">
        <label class="q-label">Q5. ã©ã®ãã‚‰ã„ã®é »åº¦ã§èµ·ãã¦ã„ã¾ã™ã‹ï¼Ÿ <span class="req">â˜…å¿…é ˆ</span></label>
        <div class="radio-group" id="q5">
          <label><input type="radio" name="q5" value="æ¯æ—¥è¤‡æ•°å›" onchange="onRadioChange('q5')"> æ¯æ—¥è¤‡æ•°å›</label>
          <label><input type="radio" name="q5" value="æ¯æ—¥1å›ç¨‹åº¦" onchange="onRadioChange('q5')"> æ¯æ—¥1å›ç¨‹åº¦</label>
          <label><input type="radio" name="q5" value="é€±ã«æ•°å›" onchange="onRadioChange('q5')"> é€±ã«æ•°å›</label>
          <label><input type="radio" name="q5" value="æœˆã«æ•°å›" onchange="onRadioChange('q5')"> æœˆã«æ•°å›</label>
          <label><input type="radio" name="q5" value="ç¨€ã ãŒç™ºç”Ÿã™ã‚‹ã¨é‡å¤§" onchange="onRadioChange('q5')"> ç¨€ã ãŒç™ºç”Ÿã™ã‚‹ã¨é‡å¤§ï¼ˆãƒã‚¤ãƒªã‚¹ã‚¯ï¼‰</label>
        </div>
        <div class="feedback-box" id="fb-q5"></div>
      </div>
      <div class="q-block">
        <label class="q-label">Q6. ã©ã®ã‚ˆã†ãªå›°ã‚Šã”ã¨ã‚„å½±éŸ¿ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ <span class="req">â˜…å¿…é ˆ</span>ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
        <div class="check-group" id="q6">
          <label><input type="checkbox" name="q6" value="åŒ»ç™‚å®‰å…¨ã®ä½ä¸‹ï¼ˆã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒªã‚¹ã‚¯ãªã©ï¼‰" onchange="onCheckChange('q6')"> åŒ»ç™‚å®‰å…¨ã®ä½ä¸‹ï¼ˆã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒªã‚¹ã‚¯ãªã©ï¼‰</label>
          <label><input type="checkbox" name="q6" value="æ¥­å‹™æ™‚é–“ã®åœ§è¿«ï¼ˆæ®‹æ¥­ãƒ»ç„¡é§„ãªè»¢è¨˜ä½œæ¥­ãªã©ï¼‰" onchange="onCheckChange('q6')"> æ¥­å‹™æ™‚é–“ã®åœ§è¿«ï¼ˆæ®‹æ¥­ãƒ»ç„¡é§„ãªè»¢è¨˜ä½œæ¥­ãªã©ï¼‰</label>
          <label><input type="checkbox" name="q6" value="æ‚£è€…ã•ã‚“ã®è‹¦ç—›ãƒ»QOLä½ä¸‹ï¼ˆç—›ã¿ã€é›¢åºŠã®é…ã‚Œãªã©ï¼‰" onchange="onCheckChange('q6')"> æ‚£è€…ã•ã‚“ã®è‹¦ç—›ãƒ»QOLä½ä¸‹ï¼ˆç—›ã¿ã€é›¢åºŠã®é…ã‚Œãªã©ï¼‰</label>
          <label><input type="checkbox" name="q6" value="ã‚¹ã‚¿ãƒƒãƒ•ã®èº«ä½“çš„ãƒ»ç²¾ç¥çš„è² æ‹…" onchange="onCheckChange('q6')"> ã‚¹ã‚¿ãƒƒãƒ•ã®èº«ä½“çš„ãƒ»ç²¾ç¥çš„è² æ‹…</label>
          <label><input type="checkbox" name="q6" value="ç‰©å“ã‚„ã‚³ã‚¹ãƒˆã®ç„¡é§„" onchange="onCheckChange('q6')"> ç‰©å“ã‚„ã‚³ã‚¹ãƒˆã®ç„¡é§„</label>
          <label><input type="checkbox" name="q6" value="ãã®ä»–" id="q6-other-check"
                        onchange="onCheckChange('q6'); toggleOtherInput('q6-other-check','q6-other-wrap')"> ãã®ä»–</label>
        </div>
        <div class="other-input-wrap" id="q6-other-wrap">
          <textarea id="q6-other-text" placeholder="ãã®ä»–ã®å†…å®¹ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„" oninput="updateProgress()"></textarea>
        </div>
        <div class="feedback-box" id="fb-q6"></div>
      </div>
      <div class="q-block">
        <label class="q-label">Q7. å…·ä½“çš„ã«ã©ã‚“ãªå ´é¢ã§å›°ã‚Šã¾ã™ã‹ï¼Ÿ</label>
        <textarea id="q7" placeholder="å…·ä½“çš„ãªå ´é¢ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"
                  oninput="onTextareaInput('q7')"></textarea>
        <div class="feedback-box" id="fb-q7"></div>
      </div>
      <div class="nav-btn-row">
        <button type="button" class="btn-prev" onclick="goPrev(1)">â† æˆ»ã‚‹</button>
        <button type="button" class="btn-next" onclick="goNext(1)">æ¬¡ã¸ï¼šä»Šã®å¯¾å¿œã‚’æ•™ãˆã‚‹ â†’</button>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—3ï¼šç¾åœ¨ã®å¯¾å¿œ -->
    <div class="block" id="step2">
      <div class="block-title">ğŸ”„ ç¬¬3ã‚¹ãƒ†ãƒƒãƒ—ï¼šä»Šã®å¯¾å¿œã¨ãã®é™ç•Œ</div>
      <div class="q-block">
        <label class="q-label">Q8. ä»Šã¯ã©ã®ã‚ˆã†ã«å·¥å¤«ã—ã¦å¯¾å¿œã—ã¦ã„ã¾ã™ã‹ï¼Ÿ</label>
        <textarea id="q8" placeholder="ç¾åœ¨ã®å¯¾å¿œæ–¹æ³•ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"
                  oninput="onTextareaInput('q8')"></textarea>
        <div class="feedback-box" id="fb-q8"></div>
      </div>
      <div class="q-block">
        <label class="q-label">Q9. ä»Šã®ã‚„ã‚Šæ–¹ã§ã€Œã†ã¾ãã„ã£ã¦ã„ãªã„ç‚¹ã€ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
        <div class="check-group" id="q9">
          <label><input type="checkbox" name="q9" value="æ‰‹ä½œæ¥­ãŒå¤šãã¦æ™‚é–“ãŒã‹ã‹ã‚‹" onchange="onCheckChange('q9')"> æ‰‹ä½œæ¥­ãŒå¤šãã¦æ™‚é–“ãŒã‹ã‹ã‚‹</label>
          <label><input type="checkbox" name="q9" value="äººã«ã‚ˆã£ã¦ã‚„ã‚Šæ–¹ã‚„ç²¾åº¦ã«ã°ã‚‰ã¤ããŒå‡ºã‚‹" onchange="onCheckChange('q9')"> äººã«ã‚ˆã£ã¦ã‚„ã‚Šæ–¹ã‚„ç²¾åº¦ã«ã°ã‚‰ã¤ããŒå‡ºã‚‹</label>
          <label><input type="checkbox" name="q9" value="æ ¹æœ¬çš„ãªè§£æ±ºï¼ˆå®‰å…¨ç¢ºä¿ãªã©ï¼‰ã«ãªã£ã¦ã„ãªã„" onchange="onCheckChange('q9')"> æ ¹æœ¬çš„ãªè§£æ±ºï¼ˆå®‰å…¨ç¢ºä¿ãªã©ï¼‰ã«ãªã£ã¦ã„ãªã„</label>
          <label><input type="checkbox" name="q9" value="æ¶ˆè€—å“è²»ãªã©ã®ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹" onchange="onCheckChange('q9')"> æ¶ˆè€—å“è²»ãªã©ã®ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹</label>
          <label><input type="checkbox" name="q9" value="ã‚¹ã‚¿ãƒƒãƒ•ã¸ã®æ•™è‚²ã‚³ã‚¹ãƒˆãŒé«˜ã„" onchange="onCheckChange('q9')"> ã‚¹ã‚¿ãƒƒãƒ•ã¸ã®æ•™è‚²ã‚³ã‚¹ãƒˆãŒé«˜ã„</label>
        </div>
        <div class="feedback-box" id="fb-q9"></div>
      </div>
      <div class="nav-btn-row">
        <button type="button" class="btn-prev" onclick="goPrev(2)">â† æˆ»ã‚‹</button>
        <button type="button" class="btn-next" onclick="goNext(2)">æ¬¡ã¸ï¼šã‚¢ã‚¤ãƒ‡ã‚¢ã‚’æ•™ãˆã‚‹ â†’</button>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—4ï¼šã‚¢ã‚¤ãƒ‡ã‚¢ -->
    <div class="block" id="step3">
      <div class="block-title">ğŸ’¡ ç¬¬4ã‚¹ãƒ†ãƒƒãƒ—ï¼šã‚ãªãŸã®ã‚¢ã‚¤ãƒ‡ã‚¢ãƒ»ã²ã‚‰ã‚ã</div>
      <div class="q-block">
        <label class="q-label">Q10. ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’æ•™ãˆã¦ãã ã•ã„ <span class="req">â˜…å¿…é ˆ</span></label>
        <textarea id="q10" rows="5" placeholder="ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’è‡ªç”±ã«è¨˜å…¥ã—ã¦ãã ã•ã„"
                  oninput="onIdeaInput()" required></textarea>
        <div class="feedback-box" id="fb-q10"></div>
      </div>
      <div class="q-block">
        <label class="q-label">Q11. ã‚¢ã‚¤ãƒ‡ã‚¢ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆä¸€ç•ªè¿‘ã„ã‚‚ã®ï¼‰ <span class="req">â˜…å¿…é ˆ</span></label>
        <div class="radio-group" id="q11">
          <label><input type="radio" name="q11" value="åŒ»ç™‚æ©Ÿå™¨ãƒ»å™¨å…·ã®æ–°è¦é–‹ç™ºã‚„æ”¹è‰¯" onchange="onRadioChange('q11')"> ğŸ”§ åŒ»ç™‚æ©Ÿå™¨ãƒ»å™¨å…·ã®æ–°è¦é–‹ç™ºã‚„æ”¹è‰¯</label>
          <label><input type="radio" name="q11" value="ã‚¢ãƒ—ãƒªãƒ»RPAã«ã‚ˆã‚‹æ¥­å‹™è‡ªå‹•åŒ–ãƒ»é›»å­åŒ–" onchange="onRadioChange('q11')"> ğŸ’» ã‚¢ãƒ—ãƒªãƒ»RPAï¼ˆUiPathãªã©ï¼‰ã«ã‚ˆã‚‹æ¥­å‹™è‡ªå‹•åŒ–ãƒ»é›»å­åŒ–</label>
          <label><input type="radio" name="q11" value="æ—¢å­˜è£½å“ã®æ–°ã—ã„ä½¿ã„æ–¹ï¼ˆè»¢ç”¨ãƒ»é©å¿œå¤–ä½¿ç”¨ãªã©ï¼‰" onchange="onRadioChange('q11')"> â™»ï¸ æ—¢å­˜è£½å“ã®æ–°ã—ã„ä½¿ã„æ–¹ï¼ˆè»¢ç”¨ãƒ»é©å¿œå¤–ä½¿ç”¨ãªã©ï¼‰</label>
          <label><input type="radio" name="q11" value="é‹ç”¨ãƒ«ãƒ¼ãƒ«ã‚„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã®å¤‰æ›´" onchange="onRadioChange('q11')"> ğŸ“„ é‹ç”¨ãƒ«ãƒ¼ãƒ«ã‚„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã®å¤‰æ›´</label>
        </div>
        <div class="feedback-box" id="fb-q11"></div>
      </div>
      <div class="nav-btn-row">
        <button type="button" class="btn-prev" onclick="goPrev(3)">â† æˆ»ã‚‹</button>
        <button type="button" class="btn-next" onclick="goNext(3)">æ¬¡ã¸ï¼šæœŸå¾…ã§ãã‚‹åŠ¹æœ â†’</button>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—5ï¼šæœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ -->
    <div class="block" id="step4">
      <div class="block-title">ğŸ“Š ç¬¬5ã‚¹ãƒ†ãƒƒãƒ—ï¼šæœŸå¾…ã§ãã‚‹åŠ¹æœ</div>
      <div class="q-block">
        <label class="q-label">Q12. ã“ã®ã‚¢ã‚¤ãƒ‡ã‚¢ãŒå®Ÿç¾ã™ã‚‹ã¨ã€ä½•ãŒæ”¹å–„ã—ãã†ã§ã™ã‹ï¼Ÿ <span class="req">â˜…å¿…é ˆ</span>ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
        <div class="check-group" id="q12">
          <label><input type="checkbox" name="q12" value="ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆä»¶æ•°ã®æ¸›å°‘ï¼ˆåŒ»ç™‚å®‰å…¨ã®å‘ä¸Šï¼‰" onchange="onCheckChange('q12')"> ğŸ›¡ï¸ ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆä»¶æ•°ã®æ¸›å°‘ï¼ˆåŒ»ç™‚å®‰å…¨ã®å‘ä¸Šï¼‰</label>
          <label><input type="checkbox" name="q12" value="æ¥­å‹™æ™‚é–“ãƒ»è¨˜éŒ²æ™‚é–“ã®çŸ­ç¸®" onchange="onCheckChange('q12')"> â±ï¸ æ¥­å‹™æ™‚é–“ãƒ»è¨˜éŒ²æ™‚é–“ã®çŸ­ç¸®</label>
          <label><input type="checkbox" name="q12" value="æ‚£è€…ã•ã‚“ã®å›å¾©ä¿ƒé€²ï¼ˆæ—©æœŸé›¢åºŠãƒ»QOLå‘ä¸Šãªã©ï¼‰" onchange="onCheckChange('q12')"> ğŸƒ æ‚£è€…ã•ã‚“ã®å›å¾©ä¿ƒé€²ï¼ˆæ—©æœŸé›¢åºŠãƒ»QOLå‘ä¸Šãªã©ï¼‰</label>
          <label><input type="checkbox" name="q12" value="ã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼ˆç‰©å“è²»ãƒ»äººä»¶è²»ãªã©ï¼‰" onchange="onCheckChange('q12')"> ğŸ’´ ã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼ˆç‰©å“è²»ãƒ»äººä»¶è²»ãªã©ï¼‰</label>
          <label><input type="checkbox" name="q12" value="ã‚¹ã‚¿ãƒƒãƒ•ã®è² æ‹…è»½æ¸›ãƒ»æº€è¶³åº¦å‘ä¸Š" onchange="onCheckChange('q12')"> ğŸ˜Š ã‚¹ã‚¿ãƒƒãƒ•ã®è² æ‹…è»½æ¸›ãƒ»æº€è¶³åº¦å‘ä¸Š</label>
          <label><input type="checkbox" name="q12" value="ãã®ä»–" id="q12-other-check"
                        onchange="onCheckChange('q12'); toggleOtherInput('q12-other-check','q12-other-wrap')"> ãã®ä»–</label>
        </div>
        <div class="other-input-wrap" id="q12-other-wrap">
          <textarea id="q12-other-text" placeholder="ãã®ä»–ã®å†…å®¹ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„" oninput="updateProgress()"></textarea>
        </div>
        <div class="feedback-box" id="fb-q12"></div>
      </div>
      <div class="q-block">
        <label class="q-label">Q13. ã©ã®ãã‚‰ã„è‰¯ããªã‚Šãã†ã‹ã€ã‚ã‹ã‚‹ç¯„å›²ã§æ•™ãˆã¦ãã ã•ã„</label>
        <textarea id="q13" placeholder="æ”¹å–„ã®è¦æ¨¡æ„Ÿã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"
                  oninput="onTextareaInput('q13')"></textarea>
        <div class="feedback-box" id="fb-q13"></div>
      </div>
      <div class="q-block">
        <label class="q-label">Q14. å‚è€ƒã«ãªã‚‹å†™çœŸãƒ»è³‡æ–™ãŒã‚ã‚Œã°ãƒ¡ãƒ¼ãƒ«ã«æ·»ä»˜ã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰</label>
      </div>
      <div class="nav-btn-row">
        <button type="button" class="btn-prev" onclick="goPrev(4)">â† æˆ»ã‚‹</button>
        <button type="button" class="btn-preview" onclick="showPreview()">ğŸ‘ï¸ å†…å®¹ã‚’ç¢ºèªã—ã¦é€ä¿¡</button>
      </div>
      <div style="display:flex; gap:12px; justify-content:center; margin-top:12px; flex-wrap:wrap;">
        <button type="button" class="btn-reset"  onclick="resetForm()">ğŸ”„ æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
        <button type="button" class="btn-finish" onclick="showEndScreen()">âœ… çµ‚äº†</button>
      </div>
    </div>

  </form>

  <!-- çµ‚äº†ç”»é¢ -->
  <div class="end-screen" id="endScreen">
    <div class="end-icon">ğŸŒ¿</div>
    <div class="end-title">ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ</div>
    <div class="end-divider"></div>
    <div class="end-body">
      ç¾å ´ã‹ã‚‰ã®å°ã•ãªå£°ãŒã€<strong>åŒ»ç™‚ã‚’ã‚ˆã‚Šã‚ˆãã™ã‚‹ãŸã‚ã®å¤§åˆ‡ãªä¸€æ­©</strong>ã§ã™ã€‚<br>
      æ‹…å½“éƒ¨ç½²ã«ã¦å†…å®¹ã‚’ç¢ºèªã—ã€<strong>æ¤œè¨çµæœã‚’ãƒ¡ãƒ¼ãƒ«ã«ã¦ã”é€£çµ¡</strong>ã„ãŸã—ã¾ã™ã€‚<br><br>
      ã¾ãŸæ°—ã«ãªã‚‹ã“ã¨ã‚„æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ãŒæµ®ã‹ã‚“ã ã¨ãã¯ã€<br>
      ã„ã¤ã§ã‚‚æ°—è»½ã«æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚ğŸ’š
    </div>
    <button type="button" class="btn-restart" onclick="restartFromEnd()">
      ğŸ”„ æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ææ¡ˆã™ã‚‹
    </button>
  </div>

</div><!-- /container -->

<!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼†é€ä¿¡ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-overlay" id="previewModal">
  <div class="modal">
    <h2>ğŸ“‹ å…¥åŠ›å†…å®¹ã®ç¢ºèª</h2>
    <p style="font-size:0.85em;color:#666;margin-bottom:12px;">ä»¥ä¸‹ã®å†…å®¹ã§æå‡ºã—ã¾ã™ã€‚å†…å®¹ã‚’ç¢ºèªã—ã¦ãƒ¡ãƒ¼ãƒ«ã§é€ä¿¡ã—ã¦ãã ã•ã„ã€‚</p>
    <pre id="previewText"></pre>
    <div class="modal-btn-row">
      <button class="btn-mail"  onclick="sendMail()">âœ‰ï¸ ãƒ¡ãƒ¼ãƒ«ã§é€ä¿¡</button>
      <button class="btn-close" onclick="closePreviewAndThank()">âœ– é–‰ã˜ã‚‹</button>
    </div>
  </div>
</div>

<!-- æ„Ÿè¬ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="thank-modal-overlay" id="thankModal">
  <div class="thank-modal">
    <div class="thank-icon">ğŸ‰</div>
    <div class="thank-title">ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</div>
    <div class="thank-body">
      <strong id="thank-name-label"></strong><br>
      ã‚ãªãŸã®ç¾å ´ã‹ã‚‰ã®å£°ãŒã€<br>
      <strong>åŒ»ç™‚ã‚’ã‚ˆã‚Šã‚ˆãã™ã‚‹ãŸã‚ã®ç¬¬ä¸€æ­©</strong>ã«ãªã‚Šã¾ã™ã€‚<br><br>
      ã„ãŸã ã„ãŸã‚¢ã‚¤ãƒ‡ã‚¢ã¯æ‹…å½“éƒ¨ç½²ã«ã¦å†…å®¹ã‚’ç¢ºèªã—ã€<br>
      <strong>æ¤œè¨çµæœã‚’ç™»éŒ²ã„ãŸã ã„ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¸ã”é€£çµ¡</strong>ã„ãŸã—ã¾ã™ã€‚<br>
      ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ğŸ˜Š
    </div>
    <div class="thank-reply-box">
      ğŸ“§ è¿”ä¿¡å…ˆï¼š<span class="reply-email" id="thank-reply-email"></span>
    </div>
    <div class="thank-btn-row">
      <button class="btn-new-idea" onclick="startNewIdea()">ğŸ’¡ æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ææ¡ˆã™ã‚‹</button>
      <button class="btn-just-close" onclick="closeThankModal()">ã“ã®ã¾ã¾é–‰ã˜ã‚‹</button>
    </div>
  </div>
</div>

<script>
const MAIL_TO = 'ns.morizo@gmail.com';
let startTime = null;

const NAME_NG_WORDS = ['åŒ¿å', 'ç„¡è¨˜å', 'anonymous', 'anon', 'åç„¡ã—', 'ãªã—', 'ãªã„', 'none', 'no name'];

const FORM_UI_IDS = ['stepper', 'progressWrap', 'ideaForm'];

function hideFormUI() {
  FORM_UI_IDS.forEach(id => { document.getElementById(id).style.display = 'none'; });
}
function showFormUI() {
  FORM_UI_IDS.forEach(id => { document.getElementById(id).style.display = ''; });
}

let currentStep = 0;
const TOTAL_STEPS = 5;

function showStep(step) {
  document.querySelectorAll('.block').forEach((b, i) => {
    b.classList.toggle('active', i === step);
  });
  for (let i = 0; i < TOTAL_STEPS; i++) {
    const sc = document.getElementById(`sc${i}`);
    const sl = document.getElementById(`sl${i}`);
    sc.className = 'step-circle';
    sl.className = 'step-label';
    if (i < step)        { sc.classList.add('done'); sc.innerHTML = '<span class="check-anim">âœ“</span>'; }
    else if (i === step) { sc.classList.add('active'); sc.textContent = i + 1; sl.classList.add('active'); }
    else                 { sc.textContent = i + 1; }
    if (i < TOTAL_STEPS - 1) {
      document.getElementById(`line${i}`).className = 'step-line' + (i < step ? ' done' : '');
    }
  }
  window.scrollTo({ top: 0, behavior: 'smooth' });
  currentStep = step;
}

function isNGName(val) {
  return NAME_NG_WORDS.some(w => val.toLowerCase() === w.toLowerCase());
}

const STEP_REQUIRED = [
  () => {
    const errs = [];
    if (!getVal('q1')) errs.push('Q1 æ‰€å±éƒ¨ç½²');
    const nameVal = getVal('q2');
    if (!nameVal) {
      errs.push('Q2 æ°å');
    } else if (isNGName(nameVal)) {
      errs.push('Q2 æ°åï¼ˆåŒ¿åã§ã®å—ä»˜ã¯ã§ãã¾ã›ã‚“ã€‚ãŠåå‰ã‚’ã”è¨˜å…¥ãã ã•ã„ï¼‰');
    }
    const emailVal = getVal('q2b');
    if (!emailVal) {
      errs.push('Q2-b è¿”ä¿¡ç”¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹');
    } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailVal)) {
      errs.push('Q2-b ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
    }
    if (!getRadio('q3')) errs.push('Q3 è·ç¨®');
    return errs;
  },
  () => {
    const errs = [];
    if (!getRadio('q4'))              errs.push('Q4 å›°ã£ã¦ã„ã‚‹å¯¾è±¡');
    if (!getRadio('q5'))              errs.push('Q5 ç™ºç”Ÿé »åº¦');
    if (getChecks('q6').length === 0) errs.push('Q6 å›°ã‚Šã”ã¨ãƒ»å½±éŸ¿');
    return errs;
  },
  () => [],
  () => {
    const errs = [];
    if (!getVal('q10'))   errs.push('Q10 ã‚¢ã‚¤ãƒ‡ã‚¢');
    if (!getRadio('q11')) errs.push('Q11 ã‚«ãƒ†ã‚´ãƒªãƒ¼');
    return errs;
  },
  () => {
    const errs = [];
    if (getChecks('q12').length === 0) errs.push('Q12 æœŸå¾…ã§ãã‚‹åŠ¹æœ');
    return errs;
  }
];

function goNext(step) {
  const errs = STEP_REQUIRED[step]();
  if (errs.length > 0) {
    alert('âš ï¸ ä»¥ä¸‹ã®å¿…é ˆé …ç›®ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š\n\n' + errs.join('\n'));
    return;
  }
  sendLog('step_moved', step + 1);
  showStep(step + 1);
}
function goPrev(step) { showStep(step - 1); }

function getVal(id)    { return (document.getElementById(id)||{value:''}).value.trim(); }
function getRadio(nm)  { const el = document.querySelector(`input[name="${nm}"]:checked`); return el ? el.value : ''; }
function getChecks(nm) { return [...document.querySelectorAll(`input[name="${nm}"]:checked`)].map(e=>e.value); }

function getQ6Values() {
  return getChecks('q6').map(v => {
    if (v === 'ãã®ä»–') {
      const other = getVal('q6-other-text');
      return other ? `ãã®ä»–ï¼ˆ${other}ï¼‰` : 'ãã®ä»–';
    }
    return v;
  });
}
function getQ12Values() {
  return getChecks('q12').map(v => {
    if (v === 'ãã®ä»–') {
      const other = getVal('q12-other-text');
      return other ? `ãã®ä»–ï¼ˆ${other}ï¼‰` : 'ãã®ä»–';
    }
    return v;
  });
}

function showFeedback(id, msg, type) {
  const el = document.getElementById(`fb-${id}`);
  if (!el) return;
  el.textContent = msg;
  el.className = `feedback-box feedback-${type} show`;
}
function hideFeedback(id) {
  const el = document.getElementById(`fb-${id}`);
  if (el) { el.className = 'feedback-box'; el.textContent = ''; }
}
function highlightSelected(groupId) {
  document.querySelectorAll(`#${groupId} label`).forEach(lbl => {
    lbl.classList.toggle('selected', lbl.querySelector('input').checked);
  });
}
function highlightChecked(groupId) {
  document.querySelectorAll(`#${groupId} label`).forEach(lbl => {
    lbl.classList.toggle('selected', lbl.querySelector('input').checked);
  });
}
function toggleOtherInput(checkId, wrapId) {
  const checked = document.getElementById(checkId).checked;
  const wrap = document.getElementById(wrapId);
  wrap.classList.toggle('show', checked);
  if (!checked) {
    const ta = wrap.querySelector('textarea');
    if (ta) ta.value = '';
  }
}

function updateProgress() {
  if (!startTime) startTime = new Date();
  const items = [
    getVal('q1'), getVal('q2'), getVal('q2b'),
    getRadio('q3'), getRadio('q4'),
    getRadio('q5'), getChecks('q6').length > 0 ? '1' : '',
    getVal('q7'), getVal('q8'), getChecks('q9').length > 0 ? '1' : '',
    getVal('q10'), getRadio('q11'), getChecks('q12').length > 0 ? '1' : '', getVal('q13')
  ];
  const filled = items.filter(v => v !== '').length;
  document.getElementById('progress-label').textContent = `${filled} / 14 é …ç›®å…¥åŠ›æ¸ˆã¿`;
  document.getElementById('progressFill').style.width = `${Math.round(filled / 14 * 100)}%`;
}
document.addEventListener('change', updateProgress);
document.addEventListener('input',  updateProgress);

function onSelectChange(id) {}
function onTextInput(id) {}
function onEmailInput(id) {}
function onRadioChange(name) { highlightSelected(name); }
function onCheckChange(name) { highlightChecked(name); }
function onTextareaInput(id) {}
function onIdeaInput() {}

function buildText() {
  const q6v  = getQ6Values();
  const q9v  = getChecks('q9');
  const q12v = getQ12Values();
  const endTime = new Date();
  const diffMs  = startTime ? endTime - startTime : 0;
  const mins    = Math.floor(diffMs / 60000);
  const secs    = Math.floor((diffMs % 60000) / 1000);
  const elapsed = startTime ? `${mins}åˆ†${secs}ç§’` : 'ä¸æ˜';
  const lines = [
    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
    'ã€€åŒ»ç™‚ã‚’ã‚ˆãã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ææ¡ˆãƒ•ã‚©ãƒ¼ãƒ ã€€',
    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
    '',
    'ã€åŸºæœ¬æƒ…å ±ã€‘',
    `æ‰€å±éƒ¨ç½²ã€€ã€€ã€€ï¼š${getVal('q1') || 'ï¼ˆæœªé¸æŠï¼‰'}`,
    `æ°ã€€ã€€åã€€ã€€ã€€ï¼š${getVal('q2') || 'ï¼ˆæœªè¨˜å…¥ï¼‰'}`,
    `ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼š${getVal('q2b') || 'ï¼ˆæœªè¨˜å…¥ï¼‰'}`,
    `è·ã€€ã€€ç¨®ã€€ã€€ã€€ï¼š${getRadio('q3') || 'ï¼ˆæœªé¸æŠï¼‰'}`,
    '',
    'ã€ç¾å ´ã®å›°ã‚Šã”ã¨ãƒ»èƒŒæ™¯ã€‘',
    `å›°ã£ã¦ã„ã‚‹å¯¾è±¡ï¼š${getRadio('q4') || 'ï¼ˆæœªé¸æŠï¼‰'}`,
    `ç™ºç”Ÿé »åº¦ã€€ã€€ã€€ï¼š${getRadio('q5') || 'ï¼ˆæœªé¸æŠï¼‰'}`,
    `å›°ã‚Šã”ã¨ãƒ»å½±éŸ¿ï¼š${q6v.join(' / ') || 'ï¼ˆæœªé¸æŠï¼‰'}`,
    `å…·ä½“çš„ãªå ´é¢ã€€ï¼š${getVal('q7') || 'ï¼ˆæœªè¨˜å…¥ï¼‰'}`,
    '',
    'ã€ä»Šã®å¯¾å¿œã¨ãã®é™ç•Œã€‘',
    `ç¾åœ¨ã®å¯¾å¿œã€€ã€€ã€€ã€€ï¼š${getVal('q8') || 'ï¼ˆæœªè¨˜å…¥ï¼‰'}`,
    `ã†ã¾ãã„ã£ã¦ã„ãªã„ç‚¹ï¼š${q9v.length ? q9v.join(' / ') : 'ç‰¹ã«ãªã—'}`,
    '',
    'ã€ã‚¢ã‚¤ãƒ‡ã‚¢ãƒ»ã²ã‚‰ã‚ãã€‘',
    `ã‚¢ã‚¤ãƒ‡ã‚¢å†…å®¹ï¼š${getVal('q10') || 'ï¼ˆæœªè¨˜å…¥ï¼‰'}`,
    `ã‚«ãƒ†ã‚´ãƒªãƒ¼ã€€ï¼š${getRadio('q11') || 'ï¼ˆæœªé¸æŠï¼‰'}`,
    '',
    'ã€æœŸå¾…ã§ãã‚‹åŠ¹æœã€‘',
    `æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„ï¼š${q12v.join(' / ') || 'ï¼ˆæœªé¸æŠï¼‰'}`,
    `æ”¹å–„ã®è¦æ¨¡æ„Ÿã€€ï¼š${getVal('q13') || 'ï¼ˆæœªè¨˜å…¥ï¼‰'}`,
    '',
    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
    `é€ä¿¡æ—¥æ™‚ã€€ã€€ã€€ã€€ï¼š${endTime.toLocaleString('ja-JP')}`,
    `ãƒ¬ãƒãƒ¼ãƒˆä½œæˆæ™‚é–“ï¼š${elapsed}`,
    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
  ];
  return lines.join('\n');
}

function escapeCSV(v) {
  if (v == null) v = '';
  v = String(v);
  if (v.includes('"') || v.includes(',') || v.includes('\n') || v.includes('\r')) {
    return '"' + v.replace(/"/g, '""') + '"';
  }
  return v;
}

function buildCsvText() {
  const now = new Date();
  const submissionId = now.toISOString().replace(/[-:T.Z]/g, '').slice(0, 15);
  const submittedAt  = now.toLocaleString('ja-JP');
  const q6v  = getQ6Values();
  const q9v  = getChecks('q9');
  const q12v = getQ12Values();
  const diffMs = startTime ? now - startTime : 0;
  const mins   = Math.floor(diffMs / 60000);
  const secs   = Math.floor((diffMs % 60000) / 1000);
  const elapsed = startTime ? `${mins}åˆ†${secs}ç§’` : 'ä¸æ˜';
  const rows = [['submissionid','submittedat','fieldname','value'].join(',')];
  function addRow(fieldName, value) {
    rows.push([escapeCSV(submissionId), escapeCSV(submittedAt), escapeCSV(fieldName), escapeCSV(value)].join(','));
  }
  addRow('q1_department',      getVal('q1'));
  addRow('q2_name',            getVal('q2'));
  addRow('q2b_email',          getVal('q2b'));
  addRow('q3_occupation',      getRadio('q3'));
  addRow('q4_who_suffers',     getRadio('q4'));
  addRow('q5_frequency',       getRadio('q5'));
  if (q6v.length > 0) { q6v.forEach((v, idx) => addRow(`q6_problem_${idx+1}`, v)); }
  else addRow('q6_problem_1', '');
  addRow('q7_scene',           getVal('q7'));
  addRow('q8_current_workaround', getVal('q8'));
  if (q9v.length > 0) { q9v.forEach((v, idx) => addRow(`q9_limitation_${idx+1}`, v)); }
  else addRow('q9_limitation_1', '');
  addRow('q10_idea',           getVal('q10'));
  addRow('q11_category',       getRadio('q11'));
  if (q12v.length > 0) { q12v.forEach((v, idx) => addRow(`q12_outcome_${idx+1}`, v)); }
  else addRow('q12_outcome_1', '');
  addRow('q13_expected_improvement', getVal('q13'));
  addRow('report_creation_time', elapsed);
  return rows.join('\n');
}

function sendMail() {
  const humanText = buildText();
  const csvText   = buildCsvText();
  const fullBody  = humanText + '\n\n\n--- CSVå½¢å¼ï¼ˆã‚·ã‚¹ãƒ†ãƒ å–è¾¼ç”¨ï¼‰ ---\n' + csvText;
  const subject = encodeURIComponent(`ã€ã‚¢ã‚¤ãƒ‡ã‚¢ææ¡ˆã€‘${getVal('q2')}ï¼ˆ${getVal('q1')}ï¼‰`);
  const body    = encodeURIComponent(fullBody);
  formCompleted = true;
  sendLog('completed', currentStep);
  window.location.href = `mailto:${MAIL_TO}?subject=${subject}&body=${body}`;
  closePreviewModal();
  showThankModal();
}

function showPreview() {
  const errs = STEP_REQUIRED[4]();
  if (errs.length > 0) {
    alert('âš ï¸ ä»¥ä¸‹ã®å¿…é ˆé …ç›®ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š\n\n' + errs.join('\n'));
    return;
  }
  document.getElementById('previewText').textContent = buildText();
  document.getElementById('previewModal').classList.add('active');
}

function closePreviewModal() {
  document.getElementById('previewModal').classList.remove('active');
}

function showThankModal() {
  const name  = getVal('q2');
  const email = getVal('q2b');
  document.getElementById('thank-name-label').textContent  = name;
  document.getElementById('thank-reply-email').textContent = email;
  document.getElementById('thankModal').classList.add('active');
}
function closeThankModal() {
  document.getElementById('thankModal').classList.remove('active');
}
function closePreviewAndThank() {
  closePreviewModal();
  showThankModal();
}

function startNewIdea() {
  closeThankModal();
  resetForm();
}

function resetForm() {
  document.getElementById('ideaForm').reset();
  document.querySelectorAll('.feedback-box').forEach(el => {
    el.className = 'feedback-box'; el.textContent = '';
  });
  document.querySelectorAll('.radio-group label, .check-group label').forEach(lbl => {
    lbl.classList.remove('selected');
  });
  document.querySelectorAll('.other-input-wrap').forEach(w => {
    w.classList.remove('show');
    const ta = w.querySelector('textarea');
    if (ta) ta.value = '';
  });
  startTime = null;
  showFormUI();
  document.getElementById('endScreen').classList.remove('active');
  showStep(0);
  updateProgress();
}

function showEndScreen() {
  if (!formCompleted) sendLog('abandoned_end_btn', currentStep);
  hideFormUI();
  document.getElementById('endScreen').classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function restartFromEnd() {
  document.getElementById('endScreen').classList.remove('active');
  resetForm();
}
// ============================================================
//  GAS ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
// ============================================================
const GAS_URL = 'https://script.google.com/macros/s/AKfycbym7HeLAHQrwLjebH0OCZnBcqpmvyP2ZcMS235f_myvtuqvqVy9J7xj6I7FyB4KnMFF/exec';

const _urlParams  = new URLSearchParams(window.location.search);
const SESSION_ID  = _urlParams.get('sid') || 'direct_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
const FORM_TYPE   = _urlParams.get('ft')  || 'B';

let formCompleted = false;

function sendLog(status, step) {
  var payload = {
    timestamp:  new Date().toISOString(),
    form_type:  FORM_TYPE,
    last_step:  step,
    status:     status,
    session_id: SESSION_ID
  };
  fetch(GAS_URL, {
    method:    'POST',
    body:      JSON.stringify(payload),
    keepalive: true
  }).catch(function() {});
}

sendLog('form_opened', 0);

document.addEventListener('visibilitychange', function() {
  if (document.visibilityState === 'hidden' && !formCompleted) {
    sendLog('abandoned', currentStep);
  }
});

</script>
</body>
</html>
